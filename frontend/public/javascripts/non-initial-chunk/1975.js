"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1975,2348],{1975:(e,t,a)=>{a.r(t),a.d(t,{adjustMessageContainerBottomPadding:()=>m,openActiveChatInputBox:()=>r,openActivechatInputAttachmentBox:()=>h});const n=document.getElementById("allChatSection"),i=document.getElementById("activeChatSection"),o=document.getElementById("activeChatMessageContainer");let c=document.getElementById("activeChatInputTextContent"),s=document.getElementById("allChatChatBoxContainer"),d=!1,l=i.dataset.chatId.toString();function h(){document.getElementById("activeChatInputAttachmentBoxBtn").classList.add("active-chat-input-attachment-box__btn--selected");const e=document.getElementById("activeChatInputAttachmentBox");e.classList.add("active-chat-input-attachment-box--selected"),e.classList.remove("active-chat-input-attachment-box--hide"),document.getElementById("activeChatInputAttachmentBtnContainer").classList.remove("input-attachment-btn-container--hide"),document.getElementById("activeChatInputBox").classList.add("active-chat-input-box--hide"),document.getElementById("activeChatInputSendBox").classList.add("active-chat-input-send-box--hide"),document.getElementById("activeChatInputAttachmentYoutubeBtnInputBox").classList.add("input-attachment-btn-box__input-box--hide"),m()}function r(){document.getElementById("activeChatInputAttachmentBoxBtn").classList.remove("active-chat-input-attachment-box__btn--selected"),document.getElementById("activeChatInputAttachmentBox").classList.remove("active-chat-input-attachment-box--selected"),document.getElementById("activeChatInputAttachmentBtnContainer").classList.add("input-attachment-btn-container--hide"),document.getElementById("activeChatInputBox").classList.remove("active-chat-input-box--hide"),document.getElementById("activeChatInputSendBox").classList.remove("active-chat-input-send-box--hide"),m()}function m(){o.style.paddingBottom=activeChatInputContainer.clientHeight+5+"px",o.scrollTop=o.scrollHeight}function u(){document.getElementById("ActiveChatToAllChatBtn").addEventListener("click",(async()=>{if(location.hash="",""!==i.dataset.chatId){let{sendChatMessageStopTypingSocket:e}=await a.e(9033).then(a.bind(a,9033));e(i.dataset.chatId),d=!1}})),document.getElementById("activeChatHeaderPic").addEventListener("click",(async()=>{let e=i.dataset.chatId;if(""!=e){let{createActiveChatInfoModal:t}=await Promise.all([a.e(8790),a.e(3958)]).then(a.bind(a,8790));t(e)}})),document.getElementById("activeChatHeaderName").addEventListener("click",(async()=>{let e=i.dataset.chatId;if(""!=e){let{createActiveChatInfoModal:t}=await Promise.all([a.e(8790),a.e(3958)]).then(a.bind(a,8790));t(e)}}));let e=document.getElementById("activeChatCallBtn");e&&e.addEventListener("click",(async()=>{let e=i.dataset.chatId;""!==e.toString()&&g(`/call/?chat=${e}`)}));let t=document.getElementById("activeChatCallRoomBox");t&&t.addEventListener("click",(async()=>{let e=t.dataset.callRoomId;""!==e.toString()&&g(`/call/?room=${e}`)})),document.getElementById("createNewGroupChatBtn").addEventListener("click",(async()=>{let{createGroupChatFormModal:e}=await Promise.all([a.e(3455),a.e(6720),a.e(8455),a.e(1154),a.e(8984),a.e(2021),a.e(8374),a.e(29),a.e(7042),a.e(5488)]).then(a.bind(a,2814));e()})),document.getElementById("activeChatInputReplyBoxCloseBtn").addEventListener("click",(async()=>{let{closeReplyMessageBox:e}=await a.e(6025).then(a.bind(a,6025));e()})),c.addEventListener("input",(async e=>{if(""!==i.dataset.chatId){if(""!==l&&l!==i.dataset.chatId){let{sendChatMessageStopTypingSocket:e}=await a.e(9033).then(a.bind(a,9033));e(l),d=!1,l=i.dataset.chatId.toString()}l=i.dataset.chatId.toString();let e=i.dataset.chatId.toString();const t=c.value.trim();if(t&&!d){d=!0;let{sendChatMessageStartTypingSocket:t}=await a.e(9033).then(a.bind(a,9033));t(e)}else if(!t&&d){d=!1;let{sendChatMessageStopTypingSocket:t}=await a.e(9033).then(a.bind(a,9033));t(e)}}})),s.addEventListener("click",(async e=>{let t=e.target.closest(".chat-box");if(t&&s.contains(t)){let e=t.dataset.chatId;if(e){let{fetchActiveChat:t}=await a.e(7524).then(a.bind(a,7524));t(e)}}}));let n=document.getElementById("activeChatMessageContainer");n.addEventListener("click",(async e=>{console.log("activeChatMessageContainer click");let t=e.target.closest(".active-chat-user-message-box"),i=e.target.closest('.active-chat-user-message-box__btn[data-message-box-btn ="user"]'),o=e.target.closest(".active-chat-user-message-box__content-box");if(i&&n.contains(i)){t.classList.add("active-chat-user-message-box--selected");let{createUserMessageOptionModal:e}=await Promise.all([a.e(1443),a.e(2064),a.e(2449)]).then(a.bind(a,982));e(t)}else{if(!o||!n.contains(o))return;if(t.classList.contains("active-chat-user-message-box--replied-message")){let e=t.dataset.repliedMessageId,a=document.querySelector(`.active-chat-user-message-box[data-message-id="${e}"]`);a&&(a.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),a.classList.add("active-chat-user-message-box--highlight"),setTimeout((function(){a.classList.remove("active-chat-user-message-box--highlight")}),1e3))}}})),n.addEventListener("dblclick",(async e=>{let t=e.target.closest(".active-chat-user-message-box");if(t&&n.contains(t)){let e=t.dataset.messageId,{openReplyMessageBox:n}=await a.e(6025).then(a.bind(a,6025));n(e)}}))}function g(e){const t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("target","_blank"),t.setAttribute("rel","noopener noreferrer"),t.click()}!async function(){if(!IS_INIT_CHAT_MODULE){async function e(){if(location.hash){let e=location.hash.replace("#",""),{fetchActiveChat:t}=await a.e(7524).then(a.bind(a,7524));t(e)}else document.title="Chats",n.classList.remove("all-chat-section--hide"),i.classList.add("active-chat-section--hide")}document.addEventListener("DOMContentLoaded",e),window.addEventListener("popstate",e);const t=document.getElementById("activeChatInputContainer"),c=document.getElementById("activeChatInputTextContent"),s=document.getElementById("activeChatInputAttachmentBox");c.addEventListener("input",(()=>{""===c.value?s.classList.remove("active-chat-input-attachment-box--hide"):s.classList.contains("active-chat-input-attachment-box--hide")||s.classList.add("active-chat-input-attachment-box--hide"),c.style.height="auto",c.style.height=c.scrollHeight+"px",m()}),!1);const{default:l}=await a.e(3691).then(a.bind(a,3691)),{Picker:g}=await a.e(6431).then(a.bind(a,6431));function p(e){l(c,e.native)}const v=document.getElementById("activeChatInputEmojiBtn"),b=document.getElementById("activeChatInputEmojiContainer");new g({parent:b,data:async()=>await a.e(6638).then(a.t.bind(a,6638,19)),onEmojiSelect:p,autoFocus:!1,emojiButtonColors:["rgba(155, 223, 88, 0.7)","rgba(155, 40, 88, 0.7)","rgba(40, 223, 88, 0.7)","rgba(155, 223, 88, 0.7)","rgba(40, 223, 223, 0.7)","rgba(20, 150, 150, 0.7)","rgba(150, 150, 20, 0.7)","rgba(150, 20, 150, 0.7)"],emojiButtonSize:40,emojiVersion:14,icons:"auto",maxFrequentRows:2,navPosition:"bottom",previewPosition:"none",set:"native",dynamicWidth:!0}),v.addEventListener("click",(()=>{b.classList.toggle("active-chat-input-box__emoji-container--hide")}));let{closeReplyMessageBox:y}=await a.e(6025).then(a.bind(a,6025));const{checkTimeAndCreateNewMessage:I}=await Promise.all([a.e(1443),a.e(2064),a.e(7308)]).then(a.bind(a,2064)),{updateAllChatSection:C}=await a.e(226).then(a.bind(a,226)),{default:B}=await Promise.all([a.e(3455),a.e(6720),a.e(5766)]).then(a.t.bind(a,7841,23)),{default:f}=await Promise.all([a.e(3455),a.e(6720),a.e(8455),a.e(602)]).then(a.t.bind(a,8455,23)),{default:x}=await Promise.all([a.e(3455),a.e(6720),a.e(8374),a.e(8676)]).then(a.t.bind(a,8374,23)),{default:E}=await Promise.all([a.e(3455),a.e(6720),a.e(1154),a.e(2859)]).then(a.t.bind(a,1154,23)),{default:w}=await Promise.all([a.e(3455),a.e(6720),a.e(8010)]).then(a.bind(a,8010));await a.e(3095).then(a.bind(a,3095)),await Promise.all([a.e(8984),a.e(4318)]).then(a.bind(a,7471)),await a.e(1106).then(a.bind(a,1106)),await a.e(8302).then(a.bind(a,8302)),await a.e(6514).then(a.bind(a,6514));const{default:L}=await Promise.all([a.e(3455),a.e(2021),a.e(29)]).then(a.bind(a,29)),S=new B({id:"chatMedia",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,onBeforeFileAdded:(e,t)=>(console.log(e),e.type?(e.name="",e):(S.log("Skipping file because it has no type"),S.info("Skipping file because it has no type","error",500),!1)),onBeforeUpload:e=>{},restrictions:{maxFileSize:104857600,minFileSize:null,maxTotalFileSize:1048576e3,maxNumberOfFiles:10,minNumberOfFiles:1,allowedFileTypes:["image/jpeg","image/png","image/gif","image/svg+xml","image/x-png","audio/mpeg","audio/wav","audio/x-wav","audio/ogg","audio/webm","video/mp4","video/webm","video/ogg","video/quicktime","video/x-matroska"]},meta:{mediaType:"chat-media"},infoTimeout:5e3}).use(f,{trigger:"#activeChatInputAttachmentFileBtn",target:"body",inline:!1,plugins:["Webcam","ImageEditor","Audio"],thumbnailWidth:300,showRemoveButtonAfterComplete:!1,disablePageScrollWhenModalOpen:!0,closeModalOnClickOutside:!0,theme:"light",locale:{strings:{}},note:"Images, Audios and videos only, up to 10 files, 1 file up to 100 MB",proudlyDisplayPoweredByUppy:!1}).use(x,{target:f,title:"Camera",mirror:!0,modes:["video-audio","video-only","picture"],preferredVideoMimeType:"video/mp4",showRecordingLength:!0}).use(E,{target:f,quality:.8}).use(w,{id:"Audio",target:f,showAudioSourceDropdown:!1}).use(L,{limit:4,companionUrl:"http://localhost:5000/companion"});S.on("upload-success",((e,n)=>{let c={};c.chat=i.dataset.chatId,c.hasMediaContent=!0,c.mediaContentType=e.type.split("/")[0],c.mediaContentMimeType=e.type,c.mediaContentPath=e.s3Multipart.key,c.repliedTo=t.dataset.repliedTo,fetch("/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}).then((e=>e.ok?e.json():Promise.reject(e))).then((async e=>{if(e.isSuccess)I(e.message,o,!0),y(),C(e.message);else{let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t(e.error,"error")}})).catch((async e=>{console.log(e);let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t("Server Error In Sending Message, Please Try Again","error")}))}));const M=document.getElementById("activeChatInputAttachmentYoutubeContentSendBtn"),A=document.getElementById("activeChatInputAttachmentYoutubeContent");M.addEventListener("click",(()=>{let e={};""!==A.value&&(e.chat=i.dataset.chatId,e.hasMediaContent=!0,e.mediaContentType="youtube",e.mediaContentMimeType="video/mp4",e.mediaContentPath=A.value,e.repliedTo=t.dataset.repliedTo,A.value="",fetch("/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.ok?e.json():Promise.reject(e))).then((async e=>{if(e.isSuccess)I(e.message,o,!0),y(),document.getElementById("activeChatInputAttachmentYoutubeBtnInputBox").classList.add("input-attachment-btn-box__input-box--hide"),C(e.message),P.classList.add("attachment-btn-box__input-box--hide");else{let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t(e.error,"error")}})).catch((async e=>{console.log(e);let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t("Server Error In Sending Message, Please Try Again","error")})))})),document.getElementById("activeChatInputSendBtn").addEventListener("click",(async()=>{let e={};if(""!==c.value.trim()&&""!==i.dataset.chatId){if(e.chat=i.dataset.chatId,e.hasMediaContent=!1,e.textContent=c.value.trim(),e.repliedTo=t.dataset.repliedTo,c.value="",""!==i.dataset.chatId){let{sendChatMessageStopTypingSocket:e}=await a.e(9033).then(a.bind(a,9033));e(i.dataset.chatId),d=!1}fetch("/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.ok?e.json():Promise.reject(e))).then((async e=>{if(e.isSuccess)s.classList.remove("active-chat-input-attachment-box--hide"),c.style.height="auto",c.style.height=c.scrollHeight+"px",parseInt(c.style.height.slice(0,-2))<=40?o.style.paddingBottom="60px":o.style.paddingBottom=c.style.height,I(e.message,o,!0),y(),C(e.message),o.scrollTop=o.scrollHeight;else{let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t(e.error,"error")}})).catch((async e=>{console.log(e);let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t("Server Error In Sending Message, Please Try Again","error")}))}}));const T=document.getElementById("activeChatInputAttachmentBoxBtn");T.addEventListener("click",(()=>{T.classList.contains("active-chat-input-attachment-box__btn--selected")?r():h()}));const k=document.getElementById("activeChatInputAttachmentYoutubeBtn"),P=document.getElementById("activeChatInputAttachmentYoutubeBtnInputBox");k.addEventListener("click",(()=>{P.classList.toggle("input-attachment-btn-box__input-box--hide")})),u(),IS_INIT_CHAT_MODULE=!0}}()}}]);