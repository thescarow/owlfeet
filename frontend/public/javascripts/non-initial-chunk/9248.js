"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9248,7308],{7308:(e,t,a)=>{a.r(t),a.d(t,{clearActiveChatMessageContainer:()=>h,closeActiveChatCallRoomBox:()=>E,increaseTotalReceivedMessagesCount:()=>r,onOffActiveChatInputContainer:()=>m,openActiveChatCallRoomBox:()=>g,showActiveChatSection:()=>l,updateActiveChatSection:()=>d});let s=document.getElementById("allChatSection"),n=document.getElementById("activeChatSection");const i=document.getElementById("activeChatMessageContainer");let c,o;async function l(e){document.getElementById("activeChatInputTextContent").value="",i.innerHTML="",d(e),c=0;let t=await fetch(`/message/data/unseen-messages-count/${e._id}`),l=await t.json();o=l.unseenMessagesCount,console.log("totalUnseenMessagesCount: "+o);let{openActiveChatInputBox:r}=await a.e(1975).then(a.bind(a,1975));r(),void 0!==USER_MESSAGE_BOX_OBSERVER&&USER_MESSAGE_BOX_OBSERVER.disconnect(),USER_MESSAGE_BOX_OBSERVER=new IntersectionObserver((async(e,t)=>{e.forEach((e=>{if(!0===e.isIntersecting){let a=e.target.dataset.messageId;socket.emit("chat:update-message-seen-status",{messageId:a}),t.unobserve(e.target)}}))}),{threshold:.5,root:i}),void 0!==TOP_MESSAGE_BOX_OBSERVER&&TOP_MESSAGE_BOX_OBSERVER.disconnect(),TOP_MESSAGE_BOX_OBSERVER=new IntersectionObserver((async(e,t)=>{e.forEach((async e=>{if(!0===e.isIntersecting){t.unobserve(e.target);let s=n.dataset.chatId;const{createLoadingMessagesAnimation:l}=await Promise.all([a.e(1443),a.e(2064)]).then(a.bind(a,2064));let r=l();i.insertAdjacentElement("afterbegin",r),i.scrollTop+=150,await async function(e){const{checkTimeAndCreateOldMessages:t}=await Promise.all([a.e(1443),a.e(2064)]).then(a.bind(a,2064));fetch(`/message/fetch-messages/${e}?totalReceivedMessagesCount=${c}`).then((e=>e.ok?e.json():Promise.reject(e))).then((async e=>{if(e.isSuccess)if(console.log(e),e.allMessages.length>0){if(c+=e.allMessages.length,0!==o&&o<=c){let{createUnseenMessageTagBox:s}=await Promise.all([a.e(1443),a.e(2064)]).then(a.bind(a,2064)),n=e.allMessages.length-(c-o);t(e.allMessages.slice(0,n),i,!1,!1),s(o,i,"afterbegin"),t(e.allMessages.slice(n),i,!1,!1),o=0}else t(e.allMessages,i,!1,!1);setTimeout((()=>{i.firstElementChild&&TOP_MESSAGE_BOX_OBSERVER.observe(i.firstElementChild)}),4e3)}else[...i.getElementsByClassName("loading-message-animation-box")].forEach((e=>{e.parentNode.removeChild(e)}));else{let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t(e.error,"error")}})).catch((async e=>{console.log(e);let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t("Server Error In Accessing Messages, Please Refresh Your Page","error")}))}(s)}}))}),{threshold:.5,root:i,rootMargin:"100px"}),void 0!==BOTTOM_MESSAGE_BOX_OBSERVER&&BOTTOM_MESSAGE_BOX_OBSERVER.disconnect(),BOTTOM_MESSAGE_BOX_OBSERVER=new IntersectionObserver((async(e,t)=>{e.forEach((async e=>{if(!0===e.isIntersecting){t.unobserve(e.target);let a=n.dataset.chatId;socket.emit("chat:update-chat-unseen-messages",{chatId:a})}}))}),{threshold:.5,root:i});const{checkTimeAndCreateOldMessages:h}=await Promise.all([a.e(1443),a.e(2064)]).then(a.bind(a,2064));fetch(`/message/fetch-messages/${e._id}?totalReceivedMessagesCount=0`).then((e=>e.ok?e.json():Promise.reject(e))).then((async e=>{if(e.isSuccess){if(i.innerHTML="",console.log(e),e.allMessages.length>0){if(c+=e.allMessages.length,0!==o&&o<=c){let{createUnseenMessageTagBox:t}=await Promise.all([a.e(1443),a.e(2064)]).then(a.bind(a,2064)),s=e.allMessages.length-(c-o);h(e.allMessages.slice(0,s),i,!1,!0),t(o,i,"afterbegin"),h(e.allMessages.slice(s),i,!1,!0),o=0}else h(e.allMessages,i,!1,!0);setTimeout((()=>{i.firstElementChild&&TOP_MESSAGE_BOX_OBSERVER.observe(i.firstElementChild)}),2500),setTimeout((()=>{i.lastElementChild&&BOTTOM_MESSAGE_BOX_OBSERVER.observe(i.lastElementChild)}),2e3)}let{adjustMessageContainerBottomPadding:t}=await a.e(1975).then(a.bind(a,1975));t()}else{let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t(e.error,"error")}})).catch((async e=>{console.log(e);let{createMainNotification:t}=await a.e(4932).then(a.bind(a,5967));t("Server Error In Accessing Messages, Please Refresh Your Page","error")})),s.classList.add("all-chat-section--hide"),n.classList.remove("active-chat-section--hide")}function r(){o=0,c++}async function d(e){let{closeReplyMessageBox:t}=await a.e(6025).then(a.bind(a,6025));t(),n.dataset.chatId=e._id;const s=document.getElementById("activeChatHeader"),i=document.getElementById("activeChatHeaderPic"),c=document.getElementById("activeChatImg"),o=document.getElementById("activeChatHeaderName"),l=document.getElementById("activeChatHeaderStatus");if(document.getElementById("activeChatInputContainer"),s.dataset.chatId=e._id,e.hasOwnProperty("chatPic")&&""!==e.chatPic?(c.src=e.chatPic,i.classList.add("active-chat-header__pic--hide-svg"),i.classList.remove("active-chat-header__pic--hide-img")):(i.classList.add("active-chat-header__pic--hide-img"),i.classList.remove("active-chat-header__pic--hide-svg")),o.textContent=e.chatName,e.isGroupChat)l.classList.remove("active-chat-header__chat-status--hide"),l.textContent="";else if(e.isUserActive)l.classList.remove("active-chat-header__chat-status--hide"),l.textContent="Active";else{let{timeDifferenceFromNow:t}=await a.e(7153).then(a.bind(a,7153));l.classList.remove("active-chat-header__chat-status--hide"),e.hasOwnProperty("userLastActive")?l.textContent=`last active ${t(e.userLastActive)} ago`:l.textContent=""}m(e),e.hasOwnProperty("isOnCall")&&!0===e.isOnCall?g(e.callRoomId):E()}async function h(){document.getElementById("activeChatMessageContainer").innerHTML=""}async function m(e){const t=document.getElementById("activeChatInputContainer");e.hasOwnProperty("canSendMessageToThisChat")&&!1===e.canSendMessageToThisChat?(t.classList.add("active-chat-input-container--disable"),t.classList.remove("active-chat-input-container--enable")):(t.classList.add("active-chat-input-container--enable"),t.classList.remove("active-chat-input-container--disable"))}function g(e){let t=document.getElementById("activeChatCallBtn"),a=document.getElementById("activeChatCallRoomBox");for(;a.classList.contains("chat-call-room-box--hide");)a.classList.remove("chat-call-room-box--hide");t.classList.add("active-chat-header__btn--hide"),a.dataset.callRoomId=e}function E(){let e=document.getElementById("activeChatCallBtn"),t=document.getElementById("activeChatCallRoomBox");for(;e.classList.contains("active-chat-header__btn--hide");)e.classList.remove("active-chat-header__btn--hide");t.classList.add("chat-call-room-box--hide"),t.dataset.callRoomId=""}}}]);