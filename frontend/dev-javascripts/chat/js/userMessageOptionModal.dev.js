const svg_messageInfoIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1_2)">
<path d="M50 100C22.5 100 0 77.5 0 50C0 22.5 22.5 0 50 0C77.5 0 100 22.5 100 50C100 77.5 77.5 100 50 100ZM50 8.33333C27.0833 8.33333 8.33333 27.0833 8.33333 50C8.33333 72.9167 27.0833 91.6667 50 91.6667C72.9167 91.6667 91.6667 72.9167 91.6667 50C91.6667 27.0833 72.9167 8.33333 50 8.33333Z" stroke-width="0"/>
<path d="M45.8333 75C44.1667 75 42.9167 74.1667 41.6667 72.9167C39.5833 70 41.25 65.8333 45.8333 54.5833C46.6667 52.9167 47.5 50.8333 48.3333 49.1667C46.6667 50.4167 44.1667 50.4167 42.5 48.75C40.8333 47.0833 40.8333 44.5833 42.5 42.9167C43.3333 42.5 48.3333 37.5 54.1667 37.5C55.8333 37.5 57.0833 38.3333 58.3333 39.5833C60.4167 42.5 58.75 46.6667 54.1667 57.9167C53.3333 59.5833 52.5 61.6667 51.6667 63.3333C53.3333 62.0833 55.8333 62.0833 57.5 63.75C59.1667 65.4167 59.1667 67.9167 57.5 69.5833C56.6667 70 51.6667 75 45.8333 75Z" stroke-width="0"/>
<path d="M56.25 33.3333C59.7018 33.3333 62.5 30.5351 62.5 27.0833C62.5 23.6316 59.7018 20.8333 56.25 20.8333C52.7982 20.8333 50 23.6316 50 27.0833C50 30.5351 52.7982 33.3333 56.25 33.3333Z" />
<path d="M56.25 35.4167C51.6667 35.4167 47.9167 31.6667 47.9167 27.0833C47.9167 22.5 51.6667 18.75 56.25 18.75C60.8333 18.75 64.5833 22.5 64.5833 27.0833C64.5833 31.6667 60.8333 35.4167 56.25 35.4167ZM56.25 22.9167C53.75 22.9167 52.0833 24.5833 52.0833 27.0833C52.0833 29.5833 53.75 31.25 56.25 31.25C58.75 31.25 60.4167 29.5833 60.4167 27.0833C60.4167 24.5833 58.75 22.9167 56.25 22.9167Z" stroke-width="0"/>
</g>
<defs>
<clipPath id="clip0_1_2">
<rect width="100" height="100" fill="white"/>
</clipPath>
</defs>
</svg>
`
const svg_messageDeleteIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M7.9875 22.9312C7.9875 24.1745 8.48136 25.3667 9.36044 26.2458C10.2395 27.1249 11.4318 27.6188 12.675 27.6188H15.175V83.0094C15.1791 87.0994 16.8055 91.0207 19.6973 93.913C22.589 96.8054 26.51 98.4325 30.6 98.4375H69.4C73.49 98.4325 77.411 96.8054 80.3027 93.913C83.1945 91.0207 84.8209 87.0994 84.825 83.0094V27.6188H87.325C88.5682 27.6188 89.7605 27.1249 90.6396 26.2458C91.5186 25.3667 92.0125 24.1745 92.0125 22.9312C92.0125 21.688 91.5186 20.4958 90.6396 19.6167C89.7605 18.7376 88.5682 18.2437 87.325 18.2437H70.9188V13.4062C70.9188 6.875 65.6062 1.55938 59.075 1.55938H40.925C34.3938 1.55938 29.0813 6.87187 29.0813 13.4062V18.2406H12.675C11.4318 18.2406 10.2395 18.7345 9.36044 19.6136C8.48136 20.4926 7.9875 21.688 7.9875 22.9312ZM38.4563 13.4094C38.4563 12.0437 39.5625 10.9375 40.925 10.9375H59.075C60.4375 10.9375 61.5438 12.0437 61.5438 13.4094V18.2437H38.4531V13.4062L38.4563 13.4094ZM24.55 27.6188H75.45V83.0094C75.4483 84.6137 74.8105 86.1519 73.6764 87.2866C72.5422 88.4214 71.0043 89.06 69.4 89.0625H30.6C28.9957 89.06 27.4578 88.4214 26.3236 87.2866C25.1895 86.1519 24.5517 84.6137 24.55 83.0094V27.6188Z" stroke-width="0"/>
<path d="M38.35 80.4281C39.5932 80.4281 40.7855 79.9343 41.6646 79.0552C42.5436 78.1761 43.0375 76.9838 43.0375 75.7406V40.9406C43.0375 39.6974 42.5436 38.5051 41.6646 37.6261C40.7855 36.747 39.5932 36.2531 38.35 36.2531C37.1068 36.2531 35.9145 36.747 35.0354 37.6261C34.1564 38.5051 33.6625 39.6974 33.6625 40.9406V75.7406C33.6625 76.9838 34.1564 78.1761 35.0354 79.0552C35.9145 79.9343 37.1068 80.4281 38.35 80.4281ZM61.65 80.4281C62.8932 80.4281 64.0855 79.9343 64.9646 79.0552C65.8436 78.1761 66.3375 76.9838 66.3375 75.7406V40.9406C66.3375 39.6974 65.8436 38.5051 64.9646 37.6261C64.0855 36.747 62.8932 36.2531 61.65 36.2531C60.4068 36.2531 59.2145 36.747 58.3354 37.6261C57.4564 38.5051 56.9625 39.6974 56.9625 40.9406V75.7406C56.9625 76.9838 57.4564 78.1761 58.3354 79.0552C59.2145 79.9343 60.4068 80.4281 61.65 80.4281Z" stroke-width="0"/>
</svg>
`
const svg_messageSeenByIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M50 37.5C48.3354 37.4624 46.68 37.7577 45.1311 38.3686C43.5822 38.9795 42.1709 39.8937 40.9802 41.0575C39.7894 42.2213 38.8432 43.6113 38.197 45.1459C37.5509 46.6805 37.2178 48.3286 37.2174 49.9937C37.217 51.6587 37.5492 53.3071 38.1946 54.8419C38.84 56.3768 39.7855 57.7673 40.9757 58.9317C42.1659 60.0961 43.5767 61.0111 45.1253 61.6227C46.6739 62.2344 48.3291 62.5306 49.9938 62.4937C53.2598 62.4215 56.3677 61.0736 58.6523 58.7385C60.9369 56.4034 62.2166 53.2667 62.2174 49.9999C62.2182 46.7331 60.9401 43.5958 58.6567 41.2596C56.3733 38.9233 53.266 37.5739 50 37.5Z" stroke-width="0"/>
<path d="M50 28.125C69.55 28.125 82.0125 40.2625 88.8625 50C82.0125 59.7375 69.55 71.875 50 71.875C30.45 71.875 17.9875 59.7375 11.1375 50C17.9875 40.2625 30.45 28.125 50 28.125ZM50 18.75C27.5625 18.75 10.4875 32.0812 0 50C10.4875 67.9188 27.5625 81.25 50 81.25C72.4375 81.25 89.5125 67.9188 100 50C89.5125 32.0812 72.4312 18.75 50 18.75Z" stroke-width="0" />
</svg>
`
const svg_messageReplyIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M70.8333 39.5833H30.875L36.2917 34.2083C37.0763 33.4237 37.517 32.3596 37.517 31.25C37.517 30.1404 37.0763 29.0763 36.2917 28.2917C35.5071 27.5071 34.4429 27.0663 33.3333 27.0663C32.2237 27.0663 31.1596 27.5071 30.375 28.2917L17.875 40.7917C17.4957 41.1879 17.1983 41.6552 17 42.1667C16.5833 43.1811 16.5833 44.3189 17 45.3333C17.1983 45.8448 17.4957 46.3121 17.875 46.7083L30.375 59.2083C30.7623 59.5989 31.2232 59.9088 31.7309 60.1204C32.2387 60.3319 32.7833 60.4408 33.3333 60.4408C33.8834 60.4408 34.428 60.3319 34.9357 60.1204C35.4435 59.9088 35.9043 59.5989 36.2917 59.2083C36.6822 58.821 36.9922 58.3601 37.2037 57.8524C37.4152 57.3447 37.5242 56.8 37.5242 56.25C37.5242 55.6999 37.4152 55.1553 37.2037 54.6476C36.9922 54.1398 36.6822 53.679 36.2917 53.2917L30.875 47.9167H70.8333C71.9384 47.9167 72.9982 48.3557 73.7796 49.1371C74.561 49.9185 75 50.9783 75 52.0833V68.75C75 69.8551 75.439 70.9149 76.2204 71.6963C77.0018 72.4777 78.0616 72.9167 79.1667 72.9167C80.2717 72.9167 81.3315 72.4777 82.1129 71.6963C82.8943 70.9149 83.3333 69.8551 83.3333 68.75V52.0833C83.3333 48.7681 82.0164 45.5887 79.6722 43.2445C77.328 40.9003 74.1485 39.5833 70.8333 39.5833Z"  stroke-width="3"/>
</svg>

`
const svg_messageForwardIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<path d="M83 42.1667C82.8017 41.6552 82.5043 41.1879 82.125 40.7917L69.625 28.2917C69.2365 27.9032 68.7753 27.595 68.2677 27.3848C67.7601 27.1745 67.2161 27.0663 66.6667 27.0663C65.5571 27.0663 64.4929 27.5071 63.7083 28.2917C63.3198 28.6802 63.0117 29.1414 62.8014 29.649C62.5912 30.1566 62.483 30.7006 62.483 31.25C62.483 32.3596 62.9237 33.4237 63.7083 34.2083L69.125 39.5833H29.1667C25.8515 39.5833 22.672 40.9003 20.3278 43.2445C17.9836 45.5887 16.6667 48.7681 16.6667 52.0833V68.75C16.6667 69.8551 17.1057 70.9149 17.8871 71.6963C18.6685 72.4777 19.7283 72.9167 20.8333 72.9167C21.9384 72.9167 22.9982 72.4777 23.7796 71.6963C24.561 70.9149 25 69.8551 25 68.75V52.0833C25 50.9783 25.439 49.9185 26.2204 49.1371C27.0018 48.3557 28.0616 47.9167 29.1667 47.9167H69.125L63.7083 53.2917C63.3178 53.679 63.0078 54.1398 62.7963 54.6476C62.5847 55.1553 62.4758 55.6999 62.4758 56.25C62.4758 56.8 62.5847 57.3447 62.7963 57.8524C63.0078 58.3601 63.3178 58.821 63.7083 59.2083C64.0957 59.5989 64.5565 59.9088 65.0643 60.1204C65.572 60.3319 66.1166 60.4408 66.6667 60.4408C67.2167 60.4408 67.7613 60.3319 68.2691 60.1204C68.7768 59.9088 69.2376 59.5989 69.625 59.2083L82.125 46.7083C82.5043 46.3121 82.8017 45.8448 83 45.3333C83.4167 44.3189 83.4167 43.1811 83 42.1667Z"  stroke-width="3"/>
</svg>
`
const svg_messageCopyIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M25.0018 25.5328L25 65.625C25 73.9093 31.4471 80.6877 39.5977 81.2168L40.625 81.25L68.215 81.2544C66.9268 84.8933 63.4553 87.5 59.375 87.5H37.5C27.1447 87.5 18.75 79.1053 18.75 68.75V34.375C18.75 30.2924 21.3596 26.8193 25.0018 25.5328ZM71.875 12.5C77.0527 12.5 81.25 16.6973 81.25 21.875V65.625C81.25 70.8027 77.0527 75 71.875 75H40.625C35.4473 75 31.25 70.8027 31.25 65.625V21.875C31.25 16.6973 35.4473 12.5 40.625 12.5H71.875ZM71.875 18.75H40.625C38.8991 18.75 37.5 20.1491 37.5 21.875V65.625C37.5 67.3509 38.8991 68.75 40.625 68.75H71.875C73.6009 68.75 75 67.3509 75 65.625V21.875C75 20.1491 73.6009 18.75 71.875 18.75Z"  stroke-width="3"/>
</svg>
`

let userMessageSenderOptions = ` <div class="inner-modal-option" data-user-message-option-btn="reply" >${svg_messageReplyIconBlank}Reply</div>
<div class="inner-modal-option"  data-user-message-option-btn="copy">${svg_messageCopyIconBlank}Copy</div>
<div class="inner-modal-option" data-user-message-option-btn="forward" >${svg_messageForwardIconBlank}Forward</div>
<div class="inner-modal-option" data-user-message-option-btn="delete" data-enable-for-all="true">${svg_messageDeleteIconBlank}Delete</div>
<div class="inner-modal-option" data-user-message-option-btn="info">${svg_messageInfoIconBlank}Info</div>
<div class="inner-modal-option" data-user-message-option-btn="seenBy">${svg_messageSeenByIconBlank}Seen By</div>
<div class="inner-modal-option" data-user-message-option-btn="closeModal">Close</div>`

let userMessageOtherUserOptions = `<div class="inner-modal-option" data-user-message-option-btn="reply" >${svg_messageReplyIconBlank}Reply</div>
<div class="inner-modal-option"  data-user-message-option-btn="copy">${svg_messageCopyIconBlank}Copy</div>
<div class="inner-modal-option" data-user-message-option-btn="forward" >${svg_messageForwardIconBlank}Forward</div>
<div class="inner-modal-option" data-user-message-option-btn="delete" data-enable-for-all="false">${svg_messageDeleteIconBlank}Delete</div>
<div class="inner-modal-option" data-user-message-option-btn="info">${svg_messageInfoIconBlank}Info</div>
<div class="inner-modal-option" data-user-message-option-btn="closeModal">Close</div>`

let userMessageDeletedMessageOptions = `<div class="inner-modal-option" data-user-message-option-btn="reply" >${svg_messageReplyIconBlank}Reply</div>

<div class="inner-modal-option" data-user-message-option-btn="delete" data-enable-for-all="false">${svg_messageDeleteIconBlank}Delete</div>
<div class="inner-modal-option" data-user-message-option-btn="info">${svg_messageInfoIconBlank}Info</div>
<div class="inner-modal-option" data-user-message-option-btn="closeModal">Close</div>`
import "../css/userMessageOptionModal.dev.css"
import { unSelectUserMessage } from "./message.dev"

export async function createUserMessageOptionModal(userMessageBox) {
  let senderId = userMessageBox.dataset.senderId
  let messageId = userMessageBox.dataset.messageId

  let activeChatSection = document.getElementById("activeChatSection")
  if (activeChatSection) {
    let userMessageOptionModal = document.getElementById(
      "userMessageOptionModal"
    )
    if (!userMessageOptionModal) {
      userMessageOptionModal = document.createElement("div")
      userMessageOptionModal.classList.add(
        "inner-modal",
        "inner-modal--user-message-option"
      )
      userMessageOptionModal.setAttribute("id", "userMessageOptionModal")

      userMessageOptionModal.innerHTML = `
          <div class="inner-modal-content inner-modal-content--user-message-option">
             <div class="inner-modal-options-container" id="userMessageOptionsContainer">
                
             </div>
          </div>`

      activeChatSection.insertAdjacentElement(
        "afterbegin",
        userMessageOptionModal
      )
      initialiseEventForUserMessageOptionModal(userMessageOptionModal)
    } else {
      userMessageOptionModal.classList.remove("inner-modal--hide")
    }
    userMessageOptionModal.dataset.messageId = messageId
    userMessageOptionModal.dataset.senderId = senderId
    let userMessageOptionsContainer = document.getElementById(
      "userMessageOptionsContainer"
    )
    if (
      userMessageBox.classList.contains(
        "active-chat-user-message-box--deleted-message"
      )
    ) {
      userMessageOptionsContainer.innerHTML = userMessageDeletedMessageOptions
    } else {
      if (senderId.toString() === loginUser._id.toString()) {
        userMessageOptionsContainer.innerHTML = userMessageSenderOptions
      }
      if (senderId.toString() !== loginUser._id.toString()) {
        userMessageOptionsContainer.innerHTML = userMessageOtherUserOptions
      }
    }
  }
}
async function initialiseEventForUserMessageOptionModal(
  userMessageOptionModal
) {
  let userMessageOptionsContainer = document.getElementById(
    "userMessageOptionsContainer"
  )

  userMessageOptionsContainer.addEventListener("click", async e => {
    let userMessageOptionBtn = e.target.closest(
      `[data-user-message-option-btn]`
    )
    if (
      userMessageOptionBtn &&
      userMessageOptionsContainer.contains(userMessageOptionBtn)
    ) {
      let messageId = userMessageOptionModal.dataset.messageId
      let senderId = userMessageOptionModal.dataset.senderId
      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "delete") {
        let enableForAll = userMessageOptionBtn.dataset.enableForAll
        enableForAll = enableForAll && enableForAll === "true"
        createMessageDeleteModal(messageId, enableForAll)
      }

      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "reply") {
        let { openReplyMessageBox } = await import("../js/replyMessageBox.dev")
        userMessageOptionModal.classList.add("inner-modal--hide")
        unSelectUserMessage(messageId)
        openReplyMessageBox(messageId)
      }
      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "copy") {
        let { copyUserMessage } = await import("./copyMessage.dev")
        userMessageOptionModal.classList.add("inner-modal--hide")
        unSelectUserMessage(messageId)
        copyUserMessage(messageId)
      }

      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "closeModal") {
        unSelectUserMessage(messageId)
        userMessageOptionModal.classList.add("inner-modal--hide")
      }
    } else {
      return
    }
  })

  window.addEventListener("click", e => {
    if (e.target === userMessageOptionModal) {
      let messageId = userMessageOptionModal.dataset.messageId
      unSelectUserMessage(messageId)
      userMessageOptionModal.classList.add("inner-modal--hide")
    }
  })
}

async function createMessageDeleteModal(messageId, enableForAll = false) {
  if (document.getElementById("userMessageOptionModal")) {
    document
      .getElementById("userMessageOptionModal")
      .classList.add("inner-modal--hide")
  }

  let activeChatSection = document.getElementById("activeChatSection")
  if (activeChatSection) {
    let deleteMessageModal = document.getElementById("deleteMessageModal")
    if (!deleteMessageModal) {
      deleteMessageModal = document.createElement("div")
      deleteMessageModal.classList.add(
        "inner-modal",
        "inner-modal--delete-message"
      )
      deleteMessageModal.setAttribute("id", "deleteMessageModal")

      deleteMessageModal.innerHTML = `
          <div class="inner-modal-content inner-modal-content--delete-message">
  
          <div class="inner-modal-header">
          <div class="inner-modal-header__title">
          Do you want to delete Message ?
          </div>
          </div>
          <div class="inner-modal-main">
  
          </div>
          <div class="inner-modal-btns-container">
          <div class="inner-modal-btn" id="closeDeleteMessageModalBtn">Cancel</div>
          <div class="inner-modal-btn inner-modal-btn--action" id="submitDeleteMessageRequestBtn">Delete</div>
          </div>`

      activeChatSection.insertAdjacentElement("afterbegin", deleteMessageModal)
      initialiseEventForDeleteChatModal(deleteMessageModal)
    } else {
      deleteMessageModal.classList.remove("inner-modal--hide")
    }

    let innerModalMain =
      deleteMessageModal.getElementsByClassName("inner-modal-main")[0]

    innerModalMain.innerHTML = ""
    if (enableForAll) {
      innerModalMain.insertAdjacentHTML(
        "beforeend",
        ` <div class="inner-modal-main__info">
          After deleting message for all, message will be deleted from all the member's chat.
        </div>
        <lable class="for-all-input-container">
           <input type="checkbox" class="for-all-input-container__checkbox" id="deleteMessageForAllInput">Delete Messages For All
     </lable>`
      )
    } else {
      innerModalMain.insertAdjacentHTML(
        "beforeend",
        ` <div class="inner-modal-main__info">
              After deleting message, message will be deleted from your chat permanently.
            </div>`
      )
    }

    deleteMessageModal.dataset.messageId = messageId
  }
}
async function initialiseEventForDeleteChatModal(deleteMessageModal) {
  document
    .getElementById("submitDeleteMessageRequestBtn")
    .addEventListener("click", () => {
      let messageId = deleteMessageModal.dataset.messageId
      console.log("messageId:", messageId)
      let deleteMessageData = {}

      deleteMessageData.id = messageId

      deleteMessageData.forAll = false
      let deleteMessageForAllInput = document.getElementById(
        "deleteMessageForAllInput"
      )
      if (
        deleteMessageForAllInput &&
        deleteMessageForAllInput.checked === true
      ) {
        deleteMessageData.forAll = true
      }

      fetch("/message/delete-message", {
        method: "POST", // or 'PUT'
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(deleteMessageData)
      })
        .then(response => {
          if (response.ok) {
            return response.json()
          }
          return Promise.reject(response)
        })
        .then(async data => {
          if (data.isSuccess) {
            let { updateChatBoxLatestMessage } = await import(
              "./updateAllChatSection.dev"
            )

            unSelectUserMessage(messageId)
            deleteMessageModal.classList.add("inner-modal--hide")

            if (data.isDeletedForAll) {
              let { convertUserMessageToDeletedForAllMessage } = await import(
                "./message.dev"
              )
              convertUserMessageToDeletedForAllMessage(data.deletedMessage)
              updateChatBoxLatestMessage(data.deletedForAllMessage)
            } else {
              let { deleteUserMessage } = await import("./message.dev")
              deleteUserMessage(data.deletedMessageId)
              updateChatBoxLatestMessage(data.latestMessageBasic)
            }
          } else {
            createMainNotification(data.error, "error")
          }
        })
        .catch(err => {
          console.log(err)
          createMainNotification(
            "Server Error In Deleting Message, Please Try Again",
            "error"
          )
        })
    })

  document
    .getElementById("closeDeleteMessageModalBtn")
    .addEventListener("click", () => {
      unSelectUserMessage(deleteMessageModal.dataset.messageId)
      deleteMessageModal.classList.add("inner-modal--hide")
    })
  window.addEventListener("click", e => {
    if (e.target === deleteMessageModal) {
      unSelectUserMessage(deleteMessageModal.dataset.messageId)
      deleteMessageModal.classList.add("inner-modal--hide")
    }
  })
}
