const svg_messageInfoIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_1_2)">
<path d="M50 100C22.5 100 0 77.5 0 50C0 22.5 22.5 0 50 0C77.5 0 100 22.5 100 50C100 77.5 77.5 100 50 100ZM50 8.33333C27.0833 8.33333 8.33333 27.0833 8.33333 50C8.33333 72.9167 27.0833 91.6667 50 91.6667C72.9167 91.6667 91.6667 72.9167 91.6667 50C91.6667 27.0833 72.9167 8.33333 50 8.33333Z" stroke-width="0"/>
<path d="M45.8333 75C44.1667 75 42.9167 74.1667 41.6667 72.9167C39.5833 70 41.25 65.8333 45.8333 54.5833C46.6667 52.9167 47.5 50.8333 48.3333 49.1667C46.6667 50.4167 44.1667 50.4167 42.5 48.75C40.8333 47.0833 40.8333 44.5833 42.5 42.9167C43.3333 42.5 48.3333 37.5 54.1667 37.5C55.8333 37.5 57.0833 38.3333 58.3333 39.5833C60.4167 42.5 58.75 46.6667 54.1667 57.9167C53.3333 59.5833 52.5 61.6667 51.6667 63.3333C53.3333 62.0833 55.8333 62.0833 57.5 63.75C59.1667 65.4167 59.1667 67.9167 57.5 69.5833C56.6667 70 51.6667 75 45.8333 75Z" stroke-width="0"/>
<path d="M56.25 33.3333C59.7018 33.3333 62.5 30.5351 62.5 27.0833C62.5 23.6316 59.7018 20.8333 56.25 20.8333C52.7982 20.8333 50 23.6316 50 27.0833C50 30.5351 52.7982 33.3333 56.25 33.3333Z" />
<path d="M56.25 35.4167C51.6667 35.4167 47.9167 31.6667 47.9167 27.0833C47.9167 22.5 51.6667 18.75 56.25 18.75C60.8333 18.75 64.5833 22.5 64.5833 27.0833C64.5833 31.6667 60.8333 35.4167 56.25 35.4167ZM56.25 22.9167C53.75 22.9167 52.0833 24.5833 52.0833 27.0833C52.0833 29.5833 53.75 31.25 56.25 31.25C58.75 31.25 60.4167 29.5833 60.4167 27.0833C60.4167 24.5833 58.75 22.9167 56.25 22.9167Z" stroke-width="0"/>
</g>
<defs>
<clipPath id="clip0_1_2">
<rect width="100" height="100" fill="white"/>
</clipPath>
</defs>
</svg>
`
const svg_messageDeleteIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M7.9875 22.9312C7.9875 24.1745 8.48136 25.3667 9.36044 26.2458C10.2395 27.1249 11.4318 27.6188 12.675 27.6188H15.175V83.0094C15.1791 87.0994 16.8055 91.0207 19.6973 93.913C22.589 96.8054 26.51 98.4325 30.6 98.4375H69.4C73.49 98.4325 77.411 96.8054 80.3027 93.913C83.1945 91.0207 84.8209 87.0994 84.825 83.0094V27.6188H87.325C88.5682 27.6188 89.7605 27.1249 90.6396 26.2458C91.5186 25.3667 92.0125 24.1745 92.0125 22.9312C92.0125 21.688 91.5186 20.4958 90.6396 19.6167C89.7605 18.7376 88.5682 18.2437 87.325 18.2437H70.9188V13.4062C70.9188 6.875 65.6062 1.55938 59.075 1.55938H40.925C34.3938 1.55938 29.0813 6.87187 29.0813 13.4062V18.2406H12.675C11.4318 18.2406 10.2395 18.7345 9.36044 19.6136C8.48136 20.4926 7.9875 21.688 7.9875 22.9312ZM38.4563 13.4094C38.4563 12.0437 39.5625 10.9375 40.925 10.9375H59.075C60.4375 10.9375 61.5438 12.0437 61.5438 13.4094V18.2437H38.4531V13.4062L38.4563 13.4094ZM24.55 27.6188H75.45V83.0094C75.4483 84.6137 74.8105 86.1519 73.6764 87.2866C72.5422 88.4214 71.0043 89.06 69.4 89.0625H30.6C28.9957 89.06 27.4578 88.4214 26.3236 87.2866C25.1895 86.1519 24.5517 84.6137 24.55 83.0094V27.6188Z" stroke-width="0"/>
<path d="M38.35 80.4281C39.5932 80.4281 40.7855 79.9343 41.6646 79.0552C42.5436 78.1761 43.0375 76.9838 43.0375 75.7406V40.9406C43.0375 39.6974 42.5436 38.5051 41.6646 37.6261C40.7855 36.747 39.5932 36.2531 38.35 36.2531C37.1068 36.2531 35.9145 36.747 35.0354 37.6261C34.1564 38.5051 33.6625 39.6974 33.6625 40.9406V75.7406C33.6625 76.9838 34.1564 78.1761 35.0354 79.0552C35.9145 79.9343 37.1068 80.4281 38.35 80.4281ZM61.65 80.4281C62.8932 80.4281 64.0855 79.9343 64.9646 79.0552C65.8436 78.1761 66.3375 76.9838 66.3375 75.7406V40.9406C66.3375 39.6974 65.8436 38.5051 64.9646 37.6261C64.0855 36.747 62.8932 36.2531 61.65 36.2531C60.4068 36.2531 59.2145 36.747 58.3354 37.6261C57.4564 38.5051 56.9625 39.6974 56.9625 40.9406V75.7406C56.9625 76.9838 57.4564 78.1761 58.3354 79.0552C59.2145 79.9343 60.4068 80.4281 61.65 80.4281Z" stroke-width="0"/>
</svg>
`

const svg_messageReplyIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M70.8333 39.5833H30.875L36.2917 34.2083C37.0763 33.4237 37.517 32.3596 37.517 31.25C37.517 30.1404 37.0763 29.0763 36.2917 28.2917C35.5071 27.5071 34.4429 27.0663 33.3333 27.0663C32.2237 27.0663 31.1596 27.5071 30.375 28.2917L17.875 40.7917C17.4957 41.1879 17.1983 41.6552 17 42.1667C16.5833 43.1811 16.5833 44.3189 17 45.3333C17.1983 45.8448 17.4957 46.3121 17.875 46.7083L30.375 59.2083C30.7623 59.5989 31.2232 59.9088 31.7309 60.1204C32.2387 60.3319 32.7833 60.4408 33.3333 60.4408C33.8834 60.4408 34.428 60.3319 34.9357 60.1204C35.4435 59.9088 35.9043 59.5989 36.2917 59.2083C36.6822 58.821 36.9922 58.3601 37.2037 57.8524C37.4152 57.3447 37.5242 56.8 37.5242 56.25C37.5242 55.6999 37.4152 55.1553 37.2037 54.6476C36.9922 54.1398 36.6822 53.679 36.2917 53.2917L30.875 47.9167H70.8333C71.9384 47.9167 72.9982 48.3557 73.7796 49.1371C74.561 49.9185 75 50.9783 75 52.0833V68.75C75 69.8551 75.439 70.9149 76.2204 71.6963C77.0018 72.4777 78.0616 72.9167 79.1667 72.9167C80.2717 72.9167 81.3315 72.4777 82.1129 71.6963C82.8943 70.9149 83.3333 69.8551 83.3333 68.75V52.0833C83.3333 48.7681 82.0164 45.5887 79.6722 43.2445C77.328 40.9003 74.1485 39.5833 70.8333 39.5833Z"  stroke-width="3"/>
</svg>

`
const svg_messageForwardIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<path d="M83 42.1667C82.8017 41.6552 82.5043 41.1879 82.125 40.7917L69.625 28.2917C69.2365 27.9032 68.7753 27.595 68.2677 27.3848C67.7601 27.1745 67.2161 27.0663 66.6667 27.0663C65.5571 27.0663 64.4929 27.5071 63.7083 28.2917C63.3198 28.6802 63.0117 29.1414 62.8014 29.649C62.5912 30.1566 62.483 30.7006 62.483 31.25C62.483 32.3596 62.9237 33.4237 63.7083 34.2083L69.125 39.5833H29.1667C25.8515 39.5833 22.672 40.9003 20.3278 43.2445C17.9836 45.5887 16.6667 48.7681 16.6667 52.0833V68.75C16.6667 69.8551 17.1057 70.9149 17.8871 71.6963C18.6685 72.4777 19.7283 72.9167 20.8333 72.9167C21.9384 72.9167 22.9982 72.4777 23.7796 71.6963C24.561 70.9149 25 69.8551 25 68.75V52.0833C25 50.9783 25.439 49.9185 26.2204 49.1371C27.0018 48.3557 28.0616 47.9167 29.1667 47.9167H69.125L63.7083 53.2917C63.3178 53.679 63.0078 54.1398 62.7963 54.6476C62.5847 55.1553 62.4758 55.6999 62.4758 56.25C62.4758 56.8 62.5847 57.3447 62.7963 57.8524C63.0078 58.3601 63.3178 58.821 63.7083 59.2083C64.0957 59.5989 64.5565 59.9088 65.0643 60.1204C65.572 60.3319 66.1166 60.4408 66.6667 60.4408C67.2167 60.4408 67.7613 60.3319 68.2691 60.1204C68.7768 59.9088 69.2376 59.5989 69.625 59.2083L82.125 46.7083C82.5043 46.3121 82.8017 45.8448 83 45.3333C83.4167 44.3189 83.4167 43.1811 83 42.1667Z"  stroke-width="3"/>
</svg>
`
const svg_messageCopyIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M25.0018 25.5328L25 65.625C25 73.9093 31.4471 80.6877 39.5977 81.2168L40.625 81.25L68.215 81.2544C66.9268 84.8933 63.4553 87.5 59.375 87.5H37.5C27.1447 87.5 18.75 79.1053 18.75 68.75V34.375C18.75 30.2924 21.3596 26.8193 25.0018 25.5328ZM71.875 12.5C77.0527 12.5 81.25 16.6973 81.25 21.875V65.625C81.25 70.8027 77.0527 75 71.875 75H40.625C35.4473 75 31.25 70.8027 31.25 65.625V21.875C31.25 16.6973 35.4473 12.5 40.625 12.5H71.875ZM71.875 18.75H40.625C38.8991 18.75 37.5 20.1491 37.5 21.875V65.625C37.5 67.3509 38.8991 68.75 40.625 68.75H71.875C73.6009 68.75 75 67.3509 75 65.625V21.875C75 20.1491 73.6009 18.75 71.875 18.75Z"  stroke-width="3"/>
</svg>
`
const svg_messageDoubleTick = `<svg width="99" height="60" viewBox="0 0 99 60"  xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M96.9561 7.77492C98.5903 5.91613 98.3709 3.12825 96.4661 1.54808C94.5612 -0.032131 91.6919 0.193778 90.0577 2.05257L51.1691 46.2841L47.2994 43.075C45.3941 41.4949 42.5253 41.7211 40.8911 43.5802C39.2571 45.4393 39.4769 48.2268 41.3821 49.8069L48.7009 55.8764C50.6062 57.4561 53.475 57.2303 55.1092 55.3716L96.9561 7.77492ZM69.7675 9.91481C71.4017 8.05602 71.1823 5.26819 69.2774 3.68793C67.3725 2.10771 64.5032 2.33354 62.869 4.19228L23.979 48.4236L7.91635 35.0991C6.01137 33.519 3.14224 33.7448 1.50789 35.6035C-0.126417 37.4622 0.0930049 40.2502 1.99795 41.8303L21.5099 58.016C22.4247 58.7747 23.6138 59.148 24.8156 59.0534C26.0174 58.9589 27.1335 58.4041 27.9183 57.5116L69.7675 9.91481Z" />
</svg>
`

const svg_messageViewIconBlank = `<svg width="92" height="60" viewBox="0 0 92 60"  xmlns="http://www.w3.org/2000/svg">
<path d="M46 0.833334C25.4333 0.833334 9.78333 13.575 0.166667 30C9.78333 46.425 25.4333 59.1667 46 59.1667C66.5667 59.1667 82.2208 46.425 91.8333 30C82.2208 13.575 66.5625 0.833334 46 0.833334ZM46 50.8333C28.0417 50.8333 16.7958 39.5292 10.0667 30C16.7958 20.4708 28.0417 9.16667 46 9.16667C63.9625 9.16667 75.2083 20.4708 81.9333 30C75.2083 39.5292 63.9625 50.8333 46 50.8333Z" />
<path d="M46 42.5C52.9036 42.5 58.5 36.9036 58.5 30C58.5 23.0964 52.9036 17.5 46 17.5C39.0964 17.5 33.5 23.0964 33.5 30C33.5 36.9036 39.0964 42.5 46 42.5Z" />
</svg>
`
const svg_messageDownloadIconBlank = `<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
<path d="M95 60C93.6739 60 92.4021 60.5268 91.4645 61.4645C90.5268 62.4021 90 63.6739 90 65V85C90 86.3261 89.4732 87.5979 88.5355 88.5355C87.5979 89.4732 86.3261 90 85 90H15C13.6739 90 12.4021 89.4732 11.4645 88.5355C10.5268 87.5979 10 86.3261 10 85V65C10 63.6739 9.47322 62.4021 8.53553 61.4645C7.59785 60.5268 6.32608 60 5 60C3.67392 60 2.40215 60.5268 1.46447 61.4645C0.526784 62.4021 0 63.6739 0 65V85C0 88.9782 1.58035 92.7936 4.3934 95.6066C7.20644 98.4196 11.0218 100 15 100H85C88.9782 100 92.7936 98.4196 95.6066 95.6066C98.4196 92.7936 100 88.9782 100 85V65C100 63.6739 99.4732 62.4021 98.5355 61.4645C97.5979 60.5268 96.3261 60 95 60ZM46.45 68.55C46.9255 69.0052 47.4862 69.362 48.1 69.6C48.6985 69.8645 49.3456 70.0012 50 70.0012C50.6544 70.0012 51.3015 69.8645 51.9 69.6C52.5138 69.362 53.0745 69.0052 53.55 68.55L73.55 48.55C74.4915 47.6085 75.0205 46.3315 75.0205 45C75.0205 43.6685 74.4915 42.3915 73.55 41.45C72.6085 40.5085 71.3315 39.9795 70 39.9795C68.6685 39.9795 67.3915 40.5085 66.45 41.45L55 52.95V5C55 3.67392 54.4732 2.40215 53.5355 1.46447C52.5979 0.526784 51.3261 0 50 0C48.6739 0 47.4021 0.526784 46.4645 1.46447C45.5268 2.40215 45 3.67392 45 5V52.95L33.55 41.45C33.0838 40.9838 32.5304 40.614 31.9212 40.3617C31.3121 40.1094 30.6593 39.9795 30 39.9795C29.3407 39.9795 28.6879 40.1094 28.0788 40.3617C27.4696 40.614 26.9162 40.9838 26.45 41.45C25.9838 41.9162 25.614 42.4696 25.3617 43.0788C25.1094 43.6879 24.9795 44.3407 24.9795 45C24.9795 45.6593 25.1094 46.3121 25.3617 46.9212C25.614 47.5304 25.9838 48.0838 26.45 48.55L46.45 68.55Z" />
</svg>
`
let svg_defaultUserImageIcon = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><g data-name="Layer 2"><circle cx="16" cy="6.96" r="6"/><path d="M30.86,26.84a15.07,15.07,0,0,0-4.11-7.47A12.47,12.47,0,0,0,25.13,18,15,15,0,0,0,16,15,15.24,15.24,0,0,0,5.24,19.37a15.07,15.07,0,0,0-4.11,7.47,3.42,3.42,0,0,0,.69,2.88A3.52,3.52,0,0,0,4.58,31H27.42a3.52,3.52,0,0,0,2.75-1.32A3.42,3.42,0,0,0,30.86,26.84Z"/></g></svg>
`

let userMessageSenderOptions = ` <div class="inner-modal-option" data-user-message-option-btn="reply" >${svg_messageReplyIconBlank}Reply</div>
<div class="inner-modal-option"  data-user-message-option-btn="copy">${svg_messageCopyIconBlank}Copy</div>
<div class="inner-modal-option inner-modal-option--view-media" data-user-message-option-btn="view" >${svg_messageViewIconBlank}View</div>
<div class="inner-modal-option inner-modal-option--downloaded-media" data-user-message-option-btn="download" >${svg_messageDownloadIconBlank}Download</div>
<div class="inner-modal-option" data-user-message-option-btn="forward" >${svg_messageForwardIconBlank}Forward</div>
<div class="inner-modal-option" data-user-message-option-btn="delete" data-enable-for-all="true">${svg_messageDeleteIconBlank}Delete</div>
<div class="inner-modal-option" data-user-message-option-btn="info">${svg_messageInfoIconBlank}Info</div>
<div class="inner-modal-option" data-user-message-option-btn="closeModal">Close</div>`

let userMessageOtherUserOptions = `<div class="inner-modal-option" data-user-message-option-btn="reply" >${svg_messageReplyIconBlank}Reply</div>
<div class="inner-modal-option"  data-user-message-option-btn="copy">${svg_messageCopyIconBlank}Copy</div>
<div class="inner-modal-option inner-modal-option--image" data-user-message-option-btn="view" >${svg_messageViewIconBlank}View</div>
<div class="inner-modal-option inner-modal-option--downloaded-media" data-user-message-option-btn="download" >${svg_messageDownloadIconBlank}Download</div>
<div class="inner-modal-option" data-user-message-option-btn="forward" >${svg_messageForwardIconBlank}Forward</div>
<div class="inner-modal-option" data-user-message-option-btn="delete" data-enable-for-all="false">${svg_messageDeleteIconBlank}Delete</div>
<div class="inner-modal-option" data-user-message-option-btn="closeModal">Close</div>`

let userMessageDeletedMessageOptions = `
<div class="inner-modal-option" data-user-message-option-btn="reply" >${svg_messageReplyIconBlank}Reply</div>

<div class="inner-modal-option" data-user-message-option-btn="delete" data-enable-for-all="false">${svg_messageDeleteIconBlank}Delete</div>
<div class="inner-modal-option" data-user-message-option-btn="info">${svg_messageInfoIconBlank}Info</div>
<div class="inner-modal-option" data-user-message-option-btn="closeModal">Close</div>
`
import { getTimeStringFromDate } from "../../common/getTimeStringFromDate.dev"
import "../css/userMessageOptionModal.dev.css"
import { unSelectUserMessage } from "./message.dev"

export async function createUserMessageOptionModal(userMessageBox) {
  let senderId = userMessageBox.dataset.senderId
  let messageId = userMessageBox.dataset.messageId

  let activeChatSection = document.getElementById("activeChatSection")
  if (activeChatSection) {
    let userMessageOptionModal = document.getElementById(
      "userMessageOptionModal"
    )
    if (!userMessageOptionModal) {
      userMessageOptionModal = document.createElement("div")
      userMessageOptionModal.classList.add(
        "inner-modal",
        "inner-modal--user-message-option"
      )
      userMessageOptionModal.setAttribute("id", "userMessageOptionModal")

      userMessageOptionModal.innerHTML = `
          <div class="inner-modal-content inner-modal-content--user-message-option">
             <div class="inner-modal-options-container" id="userMessageOptionsContainer">
                
             </div>
          </div>`

      activeChatSection.insertAdjacentElement(
        "afterbegin",
        userMessageOptionModal
      )
      initialiseEventForUserMessageOptionModal(userMessageOptionModal)
    } else {
      userMessageOptionModal.classList.remove("inner-modal--hide")
    }
    userMessageOptionModal.dataset.messageId = messageId
    userMessageOptionModal.dataset.senderId = senderId
    let userMessageOptionsContainer = document.getElementById(
      "userMessageOptionsContainer"
    )
    if (
      userMessageBox.classList.contains(
        "active-chat-user-message-box--deleted-message"
      )
    ) {
      userMessageOptionsContainer.innerHTML = userMessageDeletedMessageOptions
    } else {
      if (
        userMessageBox.classList.contains(
          "active-chat-user-message-box--image"
        ) ||
        userMessageBox.classList.contains(
          "active-chat-user-message-box--youtube"
        )
      ) {
        userMessageOptionsContainer.classList.add(
          "inner-modal-options-container--show-view-media"
        )
      } else {
        userMessageOptionsContainer.classList.remove(
          "inner-modal-options-container--show-view-media"
        )
      }
      if (
        userMessageBox.classList.contains(
          "active-chat-user-message-box--video"
        ) ||
        userMessageBox.classList.contains(
          "active-chat-user-message-box--image"
        ) ||
        userMessageBox.classList.contains("active-chat-user-message-box--audio")
      ) {
        userMessageOptionsContainer.classList.add(
          "inner-modal-options-container--show-downloaded-media"
        )
      } else {
        userMessageOptionsContainer.classList.remove(
          "inner-modal-options-container--show-downloaded-media"
        )
      }
      if (senderId.toString() === loginUser._id.toString()) {
        userMessageOptionsContainer.innerHTML = userMessageSenderOptions
      }
      if (senderId.toString() !== loginUser._id.toString()) {
        userMessageOptionsContainer.innerHTML = userMessageOtherUserOptions
      }
    }
  }
}
async function initialiseEventForUserMessageOptionModal(
  userMessageOptionModal
) {
  let userMessageOptionsContainer = document.getElementById(
    "userMessageOptionsContainer"
  )

  userMessageOptionsContainer.addEventListener("click", async e => {
    let userMessageOptionBtn = e.target.closest(
      `[data-user-message-option-btn]`
    )
    if (
      userMessageOptionBtn &&
      userMessageOptionsContainer.contains(userMessageOptionBtn)
    ) {
      let messageId = userMessageOptionModal.dataset.messageId
      let senderId = userMessageOptionModal.dataset.senderId
      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "delete") {
        let enableForAll = userMessageOptionBtn.dataset.enableForAll
        enableForAll = enableForAll && enableForAll === "true"
        createMessageDeleteModal(messageId, enableForAll)
      }

      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "reply") {
        let { openReplyMessageBox } = await import("../js/replyMessageBox.dev")
        userMessageOptionModal.classList.add("inner-modal--hide")
        unSelectUserMessage(messageId)
        openReplyMessageBox(messageId)
      }
      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "copy") {
        let { copyUserMessage } = await import("./copyMessage.dev")
        userMessageOptionModal.classList.add("inner-modal--hide")
        unSelectUserMessage(messageId)
        copyUserMessage(messageId)
      }
      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "info") {
        import("../css/messageInfoModal.dev.css")
        unSelectUserMessage(messageId)
        createMessageInfoModal(messageId)
      }
      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "download") {
        let { downloadUserMedia } = await import("./downloadUserMedia.dev")
        userMessageOptionModal.classList.add("inner-modal--hide")
        unSelectUserMessage(messageId)
        downloadUserMedia(messageId)
      }
      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "view") {
        let { viewUserMedia } = await import("./viewUserMedia.dev")
        userMessageOptionModal.classList.add("inner-modal--hide")
        unSelectUserMessage(messageId)
        viewUserMedia(messageId)
      }

      if (userMessageOptionBtn.dataset.userMessageOptionBtn === "closeModal") {
        unSelectUserMessage(messageId)
        userMessageOptionModal.classList.add("inner-modal--hide")
      }
    } else {
      return
    }
  })

  window.addEventListener("click", e => {
    if (e.target === userMessageOptionModal) {
      let messageId = userMessageOptionModal.dataset.messageId
      unSelectUserMessage(messageId)
      userMessageOptionModal.classList.add("inner-modal--hide")
    }
  })
}

async function createMessageDeleteModal(messageId, enableForAll = false) {
  if (document.getElementById("userMessageOptionModal")) {
    document
      .getElementById("userMessageOptionModal")
      .classList.add("inner-modal--hide")
  }

  let activeChatSection = document.getElementById("activeChatSection")
  if (activeChatSection) {
    let deleteMessageModal = document.getElementById("deleteMessageModal")
    if (!deleteMessageModal) {
      deleteMessageModal = document.createElement("div")
      deleteMessageModal.classList.add(
        "inner-modal",
        "inner-modal--delete-message"
      )
      deleteMessageModal.setAttribute("id", "deleteMessageModal")

      deleteMessageModal.innerHTML = `
          <div class="inner-modal-content inner-modal-content--delete-message">
  
          <div class="inner-modal-header">
          <div class="inner-modal-header__title">
          Do you want to delete Message ?
          </div>
          </div>
          <div class="inner-modal-main">
  
          </div>
          <div class="inner-modal-btns-container">
          <div class="inner-modal-btn" id="closeDeleteMessageModalBtn">Cancel</div>
          <div class="inner-modal-btn inner-modal-btn--action" id="submitDeleteMessageRequestBtn">Delete</div>
          </div>
          </div>`

      activeChatSection.insertAdjacentElement("afterbegin", deleteMessageModal)
      initialiseEventForDeleteMessageModal(deleteMessageModal)
    } else {
      deleteMessageModal.classList.remove("inner-modal--hide")
    }

    let innerModalMain =
      deleteMessageModal.getElementsByClassName("inner-modal-main")[0]

    innerModalMain.innerHTML = ""
    if (enableForAll) {
      innerModalMain.insertAdjacentHTML(
        "beforeend",
        ` <div class="inner-modal-main__info">
          After deleting message for all, message will be deleted from all the member's chat.
        </div>
        <lable class="for-all-input-container">
           <input type="checkbox" class="for-all-input-container__checkbox" id="deleteMessageForAllInput">Delete Messages For All
     </lable>`
      )
    } else {
      innerModalMain.insertAdjacentHTML(
        "beforeend",
        ` <div class="inner-modal-main__info">
              After deleting message, message will be deleted from your chat permanently.
            </div>`
      )
    }

    deleteMessageModal.dataset.messageId = messageId
  }
}
async function initialiseEventForDeleteMessageModal(deleteMessageModal) {
  document
    .getElementById("submitDeleteMessageRequestBtn")
    .addEventListener("click", () => {
      deleteMessageModal.classList.add("inner-modal--hide")

      let messageId = deleteMessageModal.dataset.messageId

      let deleteMessageData = {}

      deleteMessageData.id = messageId

      deleteMessageData.forAll = false
      let deleteMessageForAllInput = document.getElementById(
        "deleteMessageForAllInput"
      )
      if (
        deleteMessageForAllInput &&
        deleteMessageForAllInput.checked === true
      ) {
        deleteMessageData.forAll = true
      }

      fetch("/message/delete-message", {
        method: "POST", // or 'PUT'
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(deleteMessageData)
      })
        .then(response => {
          if (response.ok) {
            return response.json()
          }
          return Promise.reject(response)
        })
        .then(async data => {
          if (data.isSuccess) {
            if (data.isDeletedForAll) {
              unSelectUserMessage(messageId)

              let { convertUserMessageToDeletedForAllMessage } = await import(
                "./message.dev"
              )
              convertUserMessageToDeletedForAllMessage(
                data.deletedForAllMessage
              )
            } else {
              let { deleteUserMessage } = await import("./message.dev")
              deleteUserMessage(data.deletedMessageId)
            }
            if (data.isLatestMessageChanged) {
              let { updateChatBoxLatestMessage } = await import(
                "./updateAllChatSection.dev"
              )
              updateChatBoxLatestMessage(data.latestMessage)
            }
          } else {
            let { createMainNotification } = await import(
              "../../common/mainNotification.dev"
            )
            createMainNotification(data.error, "error")
          }
        })
        .catch(async err => {
          console.log(err)
          let { createMainNotification } = await import(
            "../../common/mainNotification.dev"
          )
          createMainNotification(
            "Server Error In Deleting Message, Please Try Again",
            "error"
          )
        })
    })

  document
    .getElementById("closeDeleteMessageModalBtn")
    .addEventListener("click", () => {
      unSelectUserMessage(deleteMessageModal.dataset.messageId)
      deleteMessageModal.classList.add("inner-modal--hide")
    })
  window.addEventListener("click", e => {
    if (e.target === deleteMessageModal) {
      unSelectUserMessage(deleteMessageModal.dataset.messageId)
      deleteMessageModal.classList.add("inner-modal--hide")
    }
  })
}

function downloadMedia(messageId) {}

async function createMessageInfoModal(messageId) {
  if (document.getElementById("userMessageOptionModal")) {
    document
      .getElementById("userMessageOptionModal")
      .classList.add("inner-modal--hide")
  }

  let activeChatSection = document.getElementById("activeChatSection")
  if (activeChatSection) {
    let messageInfoModal = document.getElementById("messageInfoModal")
    if (!messageInfoModal) {
      messageInfoModal = document.createElement("div")
      messageInfoModal.classList.add("inner-modal", "inner-modal--message-info")
      messageInfoModal.setAttribute("id", "messageInfoModal")

      messageInfoModal.dataset.messageId = messageId

      messageInfoModal.innerHTML = `
          <div class="inner-modal-content inner-modal-content--message-info">

             <div class="inner-modal-header inner-modal-header--message-info">
                    <div class="inner-modal-header__title inner-modal-header__title--message-info"> Message Info
                   </div>
             </div>


             <div class="inner-modal-main">
                <div class="message-info-delivery-status-box message-info-delivery-status-box--delivered" id="messageInfoDeliveryStatusBox">
                    <div class="message-info-delivery-status-box__icon">
                        ${svg_messageDoubleTick}
                    </div>
                    <div class="message-info-delivery-status-box__row">
                        <div class="message-info-delivery-status-box__title">Delivered</div>
                        <div class="message-info-delivery-status-box__time" id="messageInfoDeliveryStatusTime"></div>
                    </div>  
                </div>






                <div class="message-info-seen-status-box message-info-seen-status-box--seen" id="messageInfoSeenStatusBox" data-seen-user-count="0">
                   <div class="message-info-seen-status-box__icon" id="messageInfoSeenStatusBoxIcon">
                         ${svg_messageDoubleTick}
                   </div>
                   <div class="message-info-seen-status-box__title">
                         Seen
                   </div>
                  <div class="message-info-seen-status-indicator" >
                        <div class="message-info-seen-status-indicator__user-count" id="messageInfoSeenStatusIndicatorUserCount">
                        </div>
                       <div class="message-info-seen-status-indicator__bar" id="messageInfoSeenStatusIndicatorBar">
                      <div class="message-info-seen-status-indicator__point" id="messageInfoSeenStatusIndicatorPoint">
                     </div>
                      </div>
                      <div class="message-info-seen-status-indicator__total-count" id="messageInfoSeenStatusIndicatorTotalCount">
                      </div>
                  </div>

                   <div class="message-info-seen-status-user-container" id="messageInfoSeenStatusUserContainer">
                       

                   </div>
            </div>
      </div>
</div>`

      activeChatSection.insertAdjacentElement("beforeend", messageInfoModal)
      updateMessageInfoStatus(messageInfoModal, messageId)
      initialiseEventForMessageInfoModal(messageInfoModal)
    } else {
      messageInfoModal.classList.remove("inner-modal--hide")
    }
  }

  if (messageInfoModal.dataset.messageId !== messageId) {
    updateMessageInfoStatus(messageInfoModal, messageId)
  }
}
function initialiseEventForMessageInfoModal(messageInfoModal) {
  window.addEventListener("click", e => {
    if (e.target === messageInfoModal) {
      messageInfoModal.classList.add("inner-modal--hide")
    }
  })
}

function updateMessageInfoStatus(messageInfoModal, messageId) {
  const messageInfoDeliveryStatusBox = document.getElementById(
    "messageInfoDeliveryStatusBox"
  )
  const messageInfoDeliveryStatusTime = document.getElementById(
    "messageInfoDeliveryStatusTime"
  )
  const messageInfoSeenStatusBox = document.getElementById(
    "messageInfoSeenStatusBox"
  )
  const messageInfoSeenStatusUserContainer = document.getElementById(
    "messageInfoSeenStatusUserContainer"
  )

  let messageInfoSeenStatusIndicatorPoint = document.getElementById(
    "messageInfoSeenStatusIndicatorPoint"
  )

  let messageInfoSeenStatusIndicatorUserCount = document.getElementById(
    "messageInfoSeenStatusIndicatorUserCount"
  )

  let messageInfoSeenStatusIndicatorTotalCount = document.getElementById(
    "messageInfoSeenStatusIndicatorTotalCount"
  )
  let messageInfoSeenStatusBoxIcon = messageInfoSeenStatusBox.querySelector(
    ".message-info-seen-status-box__icon svg"
  )

  messageInfoModal.dataset.messageId = messageId

  messageInfoDeliveryStatusBox.classList.remove(
    "message-info-delivery-status-box--delivered"
  )
  messageInfoDeliveryStatusTime.textContent = ""

  messageInfoSeenStatusBox.classList.remove(
    "message-info-seen-status-box--seen"
  )
  messageInfoSeenStatusIndicatorUserCount.textContent = 0
  messageInfoSeenStatusIndicatorTotalCount.textContent = 0
  messageInfoSeenStatusUserContainer.innerHTML = ""
  messageInfoSeenStatusIndicatorPoint.style.left = 0 + "px"
  messageInfoSeenStatusBoxIcon.style.fill = "rgba(var(--rgba-fourth-color),0.4)"
  messageInfoSeenStatusBoxIcon.style.strokeWidth = `1px`
  messageInfoSeenStatusBoxIcon.style.stroke = `rgba(var(--rgba-fourth-color),0.4)`

  fetch(`/message/data/status/${messageId}`)
    .then(response => {
      if (response.ok) {
        return response.json()
      }
      return Promise.reject(response)
    })
    .then(async data => {
      if (data.isSuccess) {
        if (
          data.message.hasOwnProperty("deliveryStatus") &&
          data.message.deliveryStatus.isDelivered === true
        ) {
          updateMessageInfoModalDeliveryStatus(
            data.message._id.toString(),
            data.message.deliveryStatus.deliveredTime
          )
        }
        if (
          data.message.hasOwnProperty("seenStatus") &&
          data.message.seenStatus.length
        ) {
          messageInfoSeenStatusIndicatorTotalCount.textContent =
            data.message.readerCount - 1

          data.message.seenStatus.forEach(entry => {
            addUserToMessageInfoModalSeenStatus(
              data.message._id.toString(),
              entry.seenBy,
              entry.seenTime
            )
          })
        }
      } else {
        let { createMainNotification } = await import(
          "../../common/mainNotification.dev"
        )
        createMainNotification(data.error, "error")
      }
    })
    .catch(async err => {
      let { createMainNotification } = await import(
        "../../common/mainNotification.dev"
      )
      createMainNotification(
        "Server Error In Accessing Message Status, Please try again",
        "info"
      )
    })
}

export async function addUserToMessageInfoModalSeenStatus(
  messageId,
  user,
  userTime
) {
  if (user._id.toString() !== loginUser._id.toString()) {
    let messageInfoModal = document.getElementById("messageInfoModal")
    if (messageInfoModal && messageInfoModal.dataset.messageId === messageId) {
      const messageInfoSeenStatusUserContainer = document.getElementById(
        "messageInfoSeenStatusUserContainer"
      )
      if (messageInfoSeenStatusUserContainer) {
        let messageInfoSeenStatusUser =
          messageInfoSeenStatusUserContainer.querySelector(
            `.message-info-seen-status-user[data-user-id="${user._id.toString()}"]`
          )
        if (!messageInfoSeenStatusUser) {
          messageInfoSeenStatusUser = document.createElement("div")
          messageInfoSeenStatusUser.classList.add(
            "message-info-seen-status-user"
          )
          messageInfoSeenStatusUser.dataset.userId = user._id.toString()
          messageInfoSeenStatusUser.innerHTML = `
      <div class="message-info-seen-status-user__left-box">
           <div class='message-info-seen-status-user__pic ${
             user.hasOwnProperty("profile") && user.profile !== ""
               ? "message-info-seen-status-user__pic--img"
               : "message-info-seen-status-user__pic--svg"
           }'>
                <img src='${user.profile}' alt="">
                ${svg_defaultUserImageIcon}
           </div>
          <div class="message-info-seen-status-user__name">
          
          </div>
     </div>
     <div class="message-info-seen-status-user__time">
      01/01/1975 00:00
     </div>`

          messageInfoSeenStatusUser.getElementsByClassName(
            "message-info-seen-status-user__name"
          )[0].textContent = user.firstName + " " + user.lastName
          messageInfoSeenStatusUser.getElementsByClassName(
            "message-info-seen-status-user__time"
          )[0].textContent = getTimeStringFromDate(userTime)

          messageInfoSeenStatusUserContainer.insertAdjacentElement(
            "afterbegin",
            messageInfoSeenStatusUser
          )
          let messageInfoSeenStatusBox = document.getElementById(
            "messageInfoSeenStatusBox"
          )
          let messageInfoSeenStatusBoxIcon =
            messageInfoSeenStatusBox.querySelector(
              ".message-info-seen-status-box__icon svg"
            )

          let messageInfoSeenStatusIndicatorPoint = document.getElementById(
            "messageInfoSeenStatusIndicatorPoint"
          )

          let messageInfoSeenStatusIndicatorUserCount = document.getElementById(
            "messageInfoSeenStatusIndicatorUserCount"
          )

          let messageInfoSeenStatusIndicatorTotalCount =
            document.getElementById("messageInfoSeenStatusIndicatorTotalCount")

          let seenUserCount =
            parseInt(messageInfoSeenStatusIndicatorUserCount.textContent) + 1
          let totalUserCount = parseInt(
            messageInfoSeenStatusIndicatorTotalCount.textContent
          )
          let userPercent = seenUserCount / totalUserCount
          messageInfoSeenStatusIndicatorUserCount.textContent = seenUserCount
          if (userPercent > 0.9) {
            let pointWidth = getComputedStyle(
              messageInfoSeenStatusIndicatorPoint
            ).width

            messageInfoSeenStatusIndicatorPoint.style.left =
              "calc(" +
              userPercent * 100 +
              "%" +
              " " +
              "-" +
              " " +
              pointWidth +
              ")"
          } else {
            messageInfoSeenStatusIndicatorPoint.style.left =
              userPercent * 100 + "%"
          }

          messageInfoSeenStatusBox.classList.add(
            "message-info-seen-status-box--seen"
          )
          messageInfoSeenStatusBox.dataset.seenUserCount = seenUserCount
          let { generateColorForUserMessageStatus } = await import(
            "./message.dev"
          )
          let color = generateColorForUserMessageStatus(
            seenUserCount,
            totalUserCount
          )
          // console.log("color", color)
          messageInfoSeenStatusBoxIcon.style.fill = `rgb(${color.r}, ${color.g},${color.b})`
          messageInfoSeenStatusBoxIcon.style.strokeWidth = `1px`
          messageInfoSeenStatusBoxIcon.style.stroke = `rgb(${color.r}, ${color.g},${color.b})`
        }
      }
    }
  }
}
export async function updateMessageInfoModalDeliveryStatus(
  messageId,
  deliveredTime
) {
  let messageInfoModal = document.getElementById("messageInfoModal")
  if (messageInfoModal && messageInfoModal.dataset.messageId === messageId) {
    document
      .getElementById("messageInfoDeliveryStatusBox")
      .classList.add("message-info-delivery-status-box--delivered")
    document.getElementById("messageInfoDeliveryStatusTime").textContent =
      getTimeStringFromDate(deliveredTime)
  }
}
