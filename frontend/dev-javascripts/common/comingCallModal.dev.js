let svg_callAcceptCallIcon = `
<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_4_24)">
<path d="M0 50C0 22.3902 22.3902 0 50 0C77.6098 0 100 22.3902 100 50C100 77.6098 77.6098 100 50 100C22.3902 100 0 77.6098 0 50Z" fill="#60C558"/>
<path d="M79.216 61.7537C75.3465 58.0254 71.4368 55.6876 66.7411 59.1539C62.0253 62.6404 61.5215 66.5098 61.5215 66.5098C61.5215 66.5098 61.9648 73.9262 44.0688 57.844C27.9665 39.948 35.3828 40.3913 35.3828 40.3913C35.3828 40.3913 39.2522 39.8875 42.7387 35.1717C46.2051 30.4961 43.7665 26.667 40.139 22.6969C28.5711 10.0004 21.5578 24.43 21.5578 24.43C13.3756 38.2148 27.0193 54.5792 37.5392 64.3333C47.3337 74.8734 63.7182 88.4969 77.4828 80.3148C77.4828 80.3148 92.0938 74.1479 79.216 61.7537Z" fill="#454545"/>
</g>
<defs>
<clipPath id="clip0_4_24">
<rect width="100" height="100" fill="white"/>
</clipPath>
</defs>
</svg>
`
let svg_callDeclineCallIcon = `
<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_5_30)">
<path d="M0 50C0 22.3902 22.3902 0 50 0C77.6098 0 100 22.3902 100 50C100 77.6098 77.6098 100 50 100C22.3902 100 0 77.6098 0 50Z" fill="#EF8355"/>
<path d="M23.4752 61.3724C28.8415 61.6476 33.3259 60.847 34.5957 55.1502C35.8674 49.4251 33.7091 46.1743 33.7091 46.1743C33.7091 46.1743 28.5089 40.8679 52.5661 41.2645C76.4596 44.2067 70.5715 48.7376 70.5715 48.7376C70.5715 48.7376 67.9817 51.6564 68.4443 57.5029C68.8957 63.3057 73.2482 64.5957 78.5906 65.2121C95.6506 67.2051 91.4769 51.7137 91.4769 51.7137C88.6085 35.9422 67.5755 32.543 53.2367 32.0831C38.9298 30.5542 17.6264 31.0216 12.6061 46.2271C12.6061 46.2271 5.62485 60.467 23.4752 61.3724Z" fill="#454545"/>
</g>
<defs>
<clipPath id="clip0_5_30">
<rect width="100" height="100" fill="white"/>
</clipPath>
</defs>
</svg>
`
let svg_callIgnoreCallIcon = `
<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 50C0 22.3902 22.3902 0 50 0C77.6098 0 100 22.3902 100 50C100 77.6098 77.6098 100 50 100C22.3902 100 0 77.6098 0 50Z" fill="#CBCBCB"/>
<path d="M24.3652 38.5328C28.2346 42.2612 32.1443 44.599 36.84 41.1326C41.5558 37.6461 42.0597 33.7767 42.0597 33.7767C42.0597 33.7767 41.6163 26.3603 59.5123 42.4426C75.6147 60.3386 68.1983 59.8952 68.1983 59.8952C68.1983 59.8952 64.3289 60.399 60.8424 65.1149C57.3761 69.7904 59.8146 73.6195 63.4422 77.5897C75.0101 90.2862 82.0234 75.8565 82.0234 75.8565C90.2056 62.0717 76.5619 45.7074 66.0419 35.9532C56.2475 25.4131 39.863 11.7896 26.0983 19.9718C26.0983 19.9718 11.4873 26.1387 24.3652 38.5328Z" fill="#454545"/>
<path d="M38.7344 74.7884H29.4841C27.8114 74.7884 26.4006 73.3978 26.4006 71.705V62.4748C26.4006 58.5046 32.5474 58.5046 32.5474 62.4748V71.705L29.4639 68.6215H38.7142C42.7046 68.6417 42.7046 74.7884 38.7344 74.7884Z" fill="#7A7A7A"/>
<path d="M44.0548 65.8807H37.505C36.316 65.8807 35.3285 64.8932 35.3285 63.7042V57.1544C35.3285 54.3531 39.6816 54.3531 39.6816 57.1544V63.7042L37.505 61.5276H44.0548C46.8763 61.5276 46.8763 65.8807 44.0548 65.8807ZM49.1133 58.9883H43.9339C42.9867 58.9883 42.2007 58.2023 42.2007 57.2551V52.0959C42.2007 49.8791 45.6469 49.8791 45.6469 52.0959V57.2753L43.9137 55.5421H49.0931C51.3503 55.5421 51.3503 58.9883 49.1133 58.9883ZM53.0633 53.4663H49.073C48.3474 53.4663 47.7428 52.8618 47.7428 52.1362V48.1459C47.7428 46.4329 50.4031 46.4329 50.4031 48.1459V52.1362L49.073 50.8061H53.0633C54.7763 50.8061 54.7763 53.4663 53.0633 53.4663Z" fill="#7A7A7A"/>
</svg>
`
let svg_callGroupIcon = `
<svg width="101" height="60" viewBox="0 0 101 60" xmlns="http://www.w3.org/2000/svg">
<path d="M50 30C58.0542 30 64.5833 23.4708 64.5833 15.4167C64.5833 7.36252 58.0542 0.833344 50 0.833344C41.9459 0.833344 35.4167 7.36252 35.4167 15.4167C35.4167 23.4708 41.9459 30 50 30Z" />
<path d="M72.4167 40.125C65.5148 36.4092 57.836 34.3682 50 34.1667C42.1782 34.3747 34.5144 36.4155 27.625 40.125C25.5791 41.1752 23.8626 42.7694 22.6644 44.7322C21.4661 46.695 20.8325 48.9504 20.8333 51.25V53.1667C20.8278 53.9526 20.9779 54.7319 21.2749 55.4596C21.5718 56.1874 22.0099 56.8491 22.5637 57.4068C23.1175 57.9645 23.7762 58.4071 24.5018 58.7092C25.2275 59.0112 26.0057 59.1667 26.7917 59.1667H73.2083C73.9943 59.1667 74.7725 59.0112 75.4982 58.7092C76.2238 58.4071 76.8825 57.9645 77.4363 57.4068C77.9901 56.8491 78.4282 56.1874 78.7251 55.4596C79.0221 54.7319 79.1722 53.9526 79.1667 53.1667V51.25C79.1714 48.9547 78.5441 46.7023 77.3534 44.7399C76.1628 42.7775 74.4548 41.1809 72.4167 40.125Z" />
<path d="M18.75 21.6667C24.503 21.6667 29.1667 17.003 29.1667 11.25C29.1667 5.49704 24.503 0.833344 18.75 0.833344C12.997 0.833344 8.33333 5.49704 8.33333 11.25C8.33333 17.003 12.997 21.6667 18.75 21.6667Z" />
<path d="M81.25 21.6667C87.003 21.6667 91.6667 17.003 91.6667 11.25C91.6667 5.49704 87.003 0.833344 81.25 0.833344C75.497 0.833344 70.8333 5.49704 70.8333 11.25C70.8333 17.003 75.497 21.6667 81.25 21.6667Z" />
<path d="M95.5 28.0417C91.1936 25.4363 86.2817 24 81.25 23.875C76.2183 24 71.3064 25.4363 67 28.0417C66.3567 28.4346 65.7683 28.911 65.25 29.4583C65.0062 29.7084 64.8292 30.0157 64.7352 30.352C64.6412 30.6883 64.6332 31.0428 64.712 31.383C64.7909 31.7232 64.9539 32.0381 65.1863 32.2989C65.4186 32.5596 65.7128 32.7577 66.0417 32.875C68.9009 33.8537 71.6859 35.0374 74.375 36.4167C76.7353 37.6547 78.7643 39.4408 80.2917 41.625C80.4854 41.8971 80.7417 42.1187 81.0391 42.271C81.3364 42.4232 81.666 42.5018 82 42.5H95.625C96.8408 42.4247 97.979 41.8771 98.7964 40.974C99.6139 40.0709 100.046 38.8839 100 37.6667V36.3333C100.029 34.6805 99.6295 33.0483 98.841 31.5954C98.0525 30.1425 96.9015 28.9183 95.5 28.0417ZM25.7083 36.4167C28.3968 35.0362 31.1819 33.8525 34.0417 32.875C34.3706 32.7577 34.6647 32.5596 34.897 32.2989C35.1294 32.0381 35.2925 31.7232 35.3713 31.383C35.4501 31.0428 35.4422 30.6883 35.3482 30.352C35.2542 30.0157 35.0771 29.7084 34.8333 29.4583C34.3147 28.9113 33.7263 28.435 33.0833 28.0417C28.7769 25.4363 23.865 24 18.8333 23.875C13.8017 24 8.88976 25.4363 4.58333 28.0417C3.17567 28.9219 2.02084 30.1528 1.23198 31.6136C0.443131 33.0744 0.047319 34.7152 0.0833331 36.375V37.7083C0.0485682 38.9185 0.485481 40.0949 1.30181 40.9889C2.11814 41.883 3.24998 42.4248 4.45833 42.5H18.0833C18.4174 42.5018 18.747 42.4232 19.0443 42.271C19.3416 42.1187 19.5979 41.8971 19.7917 41.625C21.3191 39.4408 23.348 37.6547 25.7083 36.4167Z" />
</svg>
`
let svg_callNonGroupIcon = `
<svg width="96" height="101" viewBox="0 0 96 101" xmlns="http://www.w3.org/2000/svg">
<path d="M51.4838 46.7817C63.3409 44.8576 71.3932 33.6858 69.4692 21.8287C67.5451 9.97161 56.3733 1.91928 44.5162 3.84332C32.6591 5.76736 24.6068 16.9392 26.5308 28.7963C28.4549 40.6534 39.6267 48.7057 51.4838 46.7817Z" />
<path d="M0.468688 77.1562C0.468688 89.9999 10.9063 100.437 23.75 100.437H72.25C85.0937 100.437 95.5313 89.9999 95.5313 77.1562C95.5313 64.3125 85.0937 53.8749 72.25 53.8749H23.75C10.9063 53.8749 0.468688 64.3125 0.468688 77.1562Z" />
</svg>
`
let svg_callDefaultRoomPicIcon = `
<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path d="M89.3125 0.249999H33.0625C31.6496 0.241761 30.2491 0.512929 28.9414 1.04791C27.6337 1.58289 26.4447 2.37112 25.4428 3.36727C24.4408 4.36342 23.6457 5.54783 23.1031 6.85237C22.5605 8.15692 22.2812 9.55587 22.2812 10.9687V67.2188C22.2521 68.6406 22.5071 70.0539 23.0311 71.3759C23.5552 72.6979 24.3378 73.9021 25.3331 74.9178C26.3285 75.9335 27.5165 76.7403 28.8277 77.2911C30.1388 77.8418 31.5466 78.1253 32.9687 78.125H90.0937C92.8097 77.9187 95.3452 76.6862 97.1852 74.6779C99.0252 72.6696 100.032 70.0361 100 67.3125V11.0625C100.012 9.64965 99.7453 8.2483 99.2141 6.93904C98.6829 5.62978 97.8981 4.43846 96.9049 3.4336C95.9116 2.42873 94.7295 1.63015 93.4265 1.08379C92.1236 0.537427 90.7254 0.254064 89.3125 0.249999ZM90.1875 58.5313C90.1103 59.0091 89.8542 59.4397 89.4712 59.7357C89.0882 60.0317 88.6069 60.1709 88.125 60.125H80.3125C79.88 55.339 77.6731 50.8879 74.1254 47.6464C70.5778 44.4049 65.9461 42.6075 61.1406 42.6075C56.3351 42.6075 51.7034 44.4049 48.1558 47.6464C44.6082 50.8879 42.4013 55.339 41.9688 60.125H34.1563C33.6744 60.1709 33.1931 60.0317 32.81 59.7357C32.427 59.4397 32.1709 59.0091 32.0938 58.5313V11.6562C32.1637 11.175 32.418 10.7397 32.8028 10.4424C33.1876 10.145 33.6729 10.0088 34.1563 10.0625H88.125C88.6084 10.0088 89.0937 10.145 89.4785 10.4424C89.8633 10.7397 90.1175 11.175 90.1875 11.6562V58.5313Z"/>
<path d="M19.0625 67.3125V21.25L8.28125 23.75C5.52227 24.3898 3.13004 26.0985 1.63004 28.5009C0.130033 30.9032 -0.355083 33.8027 0.28125 36.5625L12.9688 91.4688C13.6085 94.2277 15.3173 96.62 17.7196 98.12C20.122 99.62 23.0215 100.105 25.7813 99.4687L80.6875 86.7813C82.2073 86.4364 83.633 85.7623 84.8641 84.8067C86.0952 83.851 87.1016 82.6369 87.8125 81.25H32.9688C31.1399 81.25 29.3291 80.8893 27.6398 80.1885C25.9506 79.4877 24.4162 78.4605 23.1245 77.1659C21.8328 75.8713 20.8091 74.3346 20.1121 72.6438C19.4151 70.953 19.0584 69.1413 19.0625 67.3125ZM61.1563 22.5312C59.3502 22.5251 57.5829 23.055 56.0782 24.0539C54.5735 25.0528 53.399 26.4757 52.7036 28.1426C52.0082 29.8094 51.823 31.6451 52.1715 33.4172C52.5201 35.1893 53.3867 36.8182 54.6616 38.0975C55.9365 39.3767 57.5624 40.2489 59.3333 40.6036C61.1042 40.9582 62.9405 40.7793 64.6097 40.0896C66.2789 39.3999 67.7059 38.2303 68.71 36.7291C69.714 35.2278 70.25 33.4623 70.25 31.6562C70.25 29.2416 69.2929 26.9253 67.5884 25.2149C65.8839 23.5046 63.5709 22.5395 61.1563 22.5312Z" />
</svg>
`

let groupCallBtns = `
<div class="coming-call-btn coming-call-btn--ignore">
    <div class="coming-call-btn__inner">
             <div class="coming-call-btn__effect"></div>
             <div class="coming-call-btn__effect"></div>

            <div class="coming-call-btn__icon" data-btn-type="ignore-call">
               ${svg_callIgnoreCallIcon}
           </div>
    </div>

    <div class="coming-call-btn__title">
    Ignore
    </div>
</div>


<div class="coming-call-btn coming-call-btn--accept">
        <div class="coming-call-btn__inner">
            <div class="coming-call-btn__effect"></div>
            <div class="coming-call-btn__effect"></div>

             <div class="coming-call-btn__icon" data-btn-type="accept-call">
                  ${svg_callAcceptCallIcon}
             </div>
        </div>
    <div class="coming-call-btn__title">
      Accept
    </div>

</div>

`
let nonGroupCallBtns = `
<div class="coming-call-btn coming-call-btn--decline">
        <div class="coming-call-btn__inner">
            <div class="coming-call-btn__effect"></div>
            <div class="coming-call-btn__effect"></div>
            <div class="coming-call-btn__icon" data-btn-type="decline-call">
                  ${svg_callDeclineCallIcon}
            </div>
        </div>
    <div class="coming-call-btn__title">
    Decline
    </div>
</div>


<div class="coming-call-btn coming-call-btn--accept">
          <div class="coming-call-btn__inner">
              <div class="coming-call-btn__effect"></div>
              <div class="coming-call-btn__effect"></div>

            <div class="coming-call-btn__icon" data-btn-type="accept-call">
                 ${svg_callAcceptCallIcon}
            </div>
          </div>
    <div class="coming-call-btn__title">
      Accept
    </div>

</div>

`

import "./css/comingCallModal.dev.css"

export async function createComingCallModal(callRoom) {
  let comingCallModal = document.getElementById("comingCallModal")
  if (!comingCallModal) {
    comingCallModal = document.createElement("div")
    comingCallModal.classList.add("coming-call-modal")
    comingCallModal.setAttribute("id", "comingCallModal")

    comingCallModal.innerHTML = `
    <div class="coming-call-modal-content">
    
    <div class="coming-call" id="comingCall">

         <audio id="comingCallAudio" class="coming-call__audio" loop>
             <source src="/assets/audios/comingCallAudio.mp3" type="audio/mpeg">
         </audio>
     

        <div class='coming-call__pic'>
           ${svg_callDefaultRoomPicIcon}
                <img src=''
                    alt="Room Pic">
        </div>
        <div class="coming-call__name">
        </div>
        <div class="coming-call__status">

        </div>

        <div class="coming-call__ignore" id="comingCallIgnorebtn">
            ${svg_callIgnoreCallIcon} Ignore
        </div>

        <div class="coming-call__type">
        
            <div class="coming-call__type-icon">
            ${svg_callGroupIcon}
            </div>
            <div class="coming-call__type-info">
                Group
            </div>

        </div>
        
        <div class="coming-call__btn-container" id="comingCallMainBtnContainer">

        </div>
    </div>

</div>`

    document.body.insertAdjacentElement("afterbegin", comingCallModal)
    updateComingCallModal(callRoom)
    initialiseEventForComingCallModal(comingCallModal)
  } else {
    updateComingCallModal(callRoom)
    comingCallModal.classList.remove("coming-call-modal--hide")
  }

  // let innerModalMain =
  //   comingCallModal.getElementsByClassName("inner-modal-main")[0]

  // innerModalMain.innerHTML = ""
  // innerModalMain.insertAdjacentHTML(
  //   "beforeend",
  //   `<div class="inner-modal-main__info">
  //  After deleting chat, all messages will be deleted and this chat is also deleted.
  //  </div>`
  // )
}

function updateComingCallModal(callRoom) {
  let comingCallModal = document.getElementById("comingCallModal")
  if (comingCallModal) {
    comingCallModal.dataset.callRoomId = callRoom._id

    let comingCallAudio = document.getElementById("comingCallAudio")
    comingCallAudio.play()

    comingCallModal.getElementsByClassName("coming-call__name")[0].textContent =
      callRoom.roomName

    let comingCallPic =
      comingCallModal.getElementsByClassName("coming-call__pic")[0]

    if (callRoom.hasOwnProperty("roomPic") && callRoom.roomPic !== "") {
      comingCallPic.querySelector("img").src = callRoom.roomPic
      comingCallPic.classList.remove("coming-call__pic--svg")
      comingCallPic.classList.add("coming-call__pic--img")
    } else {
      comingCallPic.classList.remove("coming-call__pic--img")
      comingCallPic.classList.add("coming-call__pic--svg")
    }

    comingCallModal.getElementsByClassName(
      "coming-call__status"
    )[0].textContent = "calling"
    if (callRoom.isChatRoom) {
      if (callRoom.roomChat.isGroupChat) {
        let comingCallType =
          comingCallModal.getElementsByClassName("coming-call__type")[0]

        comingCallType.classList.add("coming-call__type--group")

        comingCallType.getElementsByClassName(
          "coming-call__type-icon"
        )[0].innerHTML = `${svg_callGroupIcon}`
        comingCallType.getElementsByClassName(
          "coming-call__type-info"
        )[0].textContent = `Group`

        comingCallModal.getElementsByClassName(
          "coming-call__btn-container"
        )[0].innerHTML = `${groupCallBtns}`

        document
          .getElementById("comingCallIgnorebtn")
          .classList.add("coming-call__ignore--hide")
      } else {
        let comingCallType =
          comingCallModal.getElementsByClassName("coming-call__type")[0]

        comingCallType.classList.remove("coming-call__type--group")

        comingCallType.getElementsByClassName(
          "coming-call__type-icon"
        )[0].innerHTML = `${svg_callNonGroupIcon}`

        comingCallType.getElementsByClassName(
          "coming-call__type-info"
        )[0].textContent = `Personal`

        comingCallModal.getElementsByClassName(
          "coming-call__btn-container"
        )[0].innerHTML = `${nonGroupCallBtns}`

        document
          .getElementById("comingCallIgnorebtn")
          .classList.remove("coming-call__ignore--hide")
      }
    }
  }
}
async function initialiseEventForComingCallModal() {
  let comingCallModal = document.getElementById("comingCallModal")
  if (comingCallModal) {
    let callRoomId = comingCallModal.dataset.callRoomId
    let comingCallMainBtnContainer = document.getElementById(
      "comingCallMainBtnContainer"
    )
    comingCallMainBtnContainer.addEventListener("click", async e => {
      let comingCallMainBtn = e.target.closest(`.coming-call-btn__icon`)

      if (
        comingCallMainBtn &&
        comingCallMainBtnContainer.contains(comingCallMainBtn)
      ) {
        closeComingCallModal()

        if (comingCallMainBtn.dataset.btnType === "accept-call") {
          if (callRoomId !== "") {
            openNewTab(`/call/?room=${callRoomId}`)
            // location.reload()
          }
        }
        if (comingCallMainBtn.dataset.btnType === "decline-call") {
        }
        if (comingCallMainBtn.dataset.btnType === "ignore-call") {
        }
      }
    })
    let comingCallIgnorebtn = document.getElementById("comingCallIgnorebtn")
    if (comingCallIgnorebtn) {
      comingCallIgnorebtn.addEventListener("click", () => {
        closeComingCallModal()
      })
    }
  }
}

async function closeComingCallModal() {
  let comingCallModal = document.getElementById("comingCallModal")
  if (!comingCallModal.classList.contains("coming-call-modal--hide"))
    comingCallModal.classList.add("coming-call-modal--hide")
  let comingCallAudio = document.getElementById("comingCallAudio")
  comingCallAudio.pause()
  comingCallAudio.currentTime = 0
}

function openNewTab(url) {
  const link = document.createElement("a")
  link.setAttribute("href", url)
  link.setAttribute("target", "_blank")
  link.setAttribute("rel", "noopener noreferrer")

  // simulate a click on the link to open the new tab
  link.click()
}
