let svg_profileEmailVerifiedIcon = `
<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M97.9388 44.1599L91.193 35.7901C90.1312 34.416 89.4441 32.792 89.2567 30.9806L88.07 20.3623C87.8292 18.242 86.8766 16.2661 85.3677 14.7572C83.8588 13.2483 81.8829 12.2957 79.7627 12.055L69.1443 10.8682C67.2705 10.6808 65.6465 9.86883 64.2723 8.807L55.9026 2.06121C52.4672 -0.687071 47.5953 -0.687071 44.1599 2.06121L35.7901 8.807C34.416 9.86883 32.792 10.5559 30.9806 10.7433L20.3623 11.93C15.99 12.4297 12.5547 15.8651 12.055 20.2374L10.8682 30.8557C10.6808 32.7295 9.86883 34.3535 8.807 35.7277L2.06121 44.0974C-0.687071 47.5328 -0.687071 52.4047 2.06121 55.8401L8.807 64.2099C9.86883 65.584 10.5559 67.208 10.7433 69.0194L11.93 79.6377C12.4297 84.01 15.8651 87.4453 20.2374 87.945L30.8557 89.1318C32.7295 89.3192 34.3535 90.1312 35.7277 91.193L44.0974 97.9388C47.5328 100.687 52.4047 100.687 55.8401 97.9388L64.2099 91.193C65.584 90.1312 67.208 89.4441 69.0194 89.2567L79.6377 88.07C84.01 87.5703 87.4453 84.1349 87.945 79.7627L89.1318 69.1443C89.3192 67.2705 90.1312 65.6465 91.193 64.2723L97.9388 55.9026C100.687 52.4672 100.687 47.5953 97.9388 44.1599ZM40.6621 75.0156L18.8007 53.1543L28.1699 43.7851L40.6621 56.2773L71.8926 25.0468L81.2617 34.7283L40.6621 75.0156Z" />
</svg>
`
let svg_profileEmailUnverifiedIcon = `
<svg width="100" height="100" viewBox="0 0 100 100"  xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M97.9388 44.1599L91.193 35.7901C90.1312 34.416 89.4441 32.792 89.2567 30.9806L88.07 20.3623C87.8292 18.242 86.8766 16.2661 85.3677 14.7572C83.8588 13.2483 81.8829 12.2957 79.7627 12.055L69.1443 10.8682C67.2705 10.6808 65.6465 9.86883 64.2723 8.807L55.9026 2.06121C52.4672 -0.687071 47.5953 -0.687071 44.1599 2.06121L35.7901 8.807C34.416 9.86883 32.792 10.5559 30.9806 10.7433L20.3623 11.93C15.99 12.4297 12.5547 15.8651 12.055 20.2374L10.8682 30.8557C10.6808 32.7295 9.86883 34.3535 8.807 35.7277L2.06121 44.0974C-0.687071 47.5328 -0.687071 52.4047 2.06121 55.8401L8.807 64.2099C9.86883 65.584 10.5559 67.208 10.7433 69.0194L11.93 79.6377C12.4297 84.01 15.8651 87.4453 20.2374 87.945L30.8557 89.1318C32.7295 89.3192 34.3535 90.1312 35.7277 91.193L44.0974 97.9388C47.5328 100.687 52.4047 100.687 55.8401 97.9388L64.2099 91.193C65.584 90.1312 67.208 89.4441 69.0194 89.2567L79.6377 88.07C84.01 87.5703 87.4453 84.1349 87.945 79.7627L89.1318 69.1443C89.3192 67.2705 90.1312 65.6465 91.193 64.2723L97.9388 55.9026C100.687 52.4672 100.687 47.5953 97.9388 44.1599ZM56.2773 71.8926C56.2773 73.6415 54.9032 75.0156 53.1543 75.0156H46.9082C45.2217 75.0156 43.7851 73.6415 43.7851 71.8926V65.6465C43.7851 63.8976 45.2217 62.5234 46.9082 62.5234H53.1543C54.9032 62.5234 56.2773 63.8976 56.2773 65.6465V71.8926ZM66.0212 41.3492C65.6465 42.411 64.9594 43.4104 64.1474 44.2848C63.3354 45.2842 63.273 45.4716 62.0862 46.6583C61.0868 47.7202 60.1499 48.5322 58.8382 49.4691C58.1512 50.0312 57.589 50.6558 57.0893 51.1555C56.5896 51.6552 56.2149 52.2174 55.9026 52.842C55.5903 53.4666 55.4029 54.0287 55.2155 54.7158C55.0281 55.4029 55.0281 55.5278 55.0281 56.2773H44.5971C44.5971 54.9032 44.5971 54.341 44.7845 53.2792C44.9719 52.0924 45.2842 51.0306 45.659 50.0312C46.0337 49.1568 46.5334 48.2823 47.2205 47.4079C47.9076 46.5959 48.6571 45.8463 49.7814 45.0344C51.4678 43.8476 52.03 43.1605 52.7795 41.7864C53.529 40.4122 54.0287 39.4129 54.0287 38.1012C54.0287 36.4147 53.654 35.2904 52.7795 34.4785C51.9675 33.6665 50.8432 33.2917 49.1568 33.2917C48.5946 33.2917 47.97 33.4166 47.2829 33.604C46.5959 33.7914 46.2211 34.1661 45.7214 34.6034C45.2217 35.0406 44.847 35.2904 44.4722 35.8526C44.075 36.346 43.8747 36.9691 43.9101 37.6015H31.4179C31.4179 35.228 32.2299 34.1037 33.1043 32.4172C34.1037 30.7308 35.3529 29.2942 36.9144 28.2324C38.476 27.1705 40.3498 26.3585 42.411 25.8588C44.4722 25.3592 46.7833 25.0468 49.2192 25.0468C51.9675 25.0468 54.4035 25.3592 56.5272 25.8588C58.6508 26.421 60.4622 27.233 62.0237 28.2948C63.4603 29.3567 64.5846 30.6683 65.4591 32.2299C66.2711 33.7914 66.6458 35.6652 66.6458 37.7264C66.6458 39.1006 66.6458 40.3498 66.1462 41.4116L66.0212 41.3492Z" />
</svg>
`
import { createMainNotification } from "../../common/mainNotification.dev.js"

import emailValidator from "email-validator"
import "../css/profileVerifyUserEmailOption.dev.css"
export function setVerifyEmailContent(modalBox, modalContentBox, profileUser) {
  modalContentBox.innerHTML = ""
  let verifyEmail = document.createElement("div")
  verifyEmail.classList.add("verify-email")
  verifyEmail.setAttribute("id", "verifyEmail")

  verifyEmail.innerHTML = `

     <div class="verify-email__title">
           Verify Your Email
     </div>
  
     <div class="verify-email__data"> 
          <input id="verifyEmailInput"  class="verify-email__email ${
            profileUser.isEmailVerified
              ? "verify-email__email--verified"
              : "verify-email__email--unverified"
          }" type="text" placeholder='Email' value="${
    profileUser.email || ""
  }" ${profileUser.isEmailVerified ? "readonly" : ""}  >
  
   
       
          <div class="verify-email__status ${
            profileUser.isEmailVerified
              ? "verify-email__status--verified"
              : "verify-email__status--unverified"
          }">
              <div class="verify-email__status-icon">
              ${
                profileUser.isEmailVerified
                  ? svg_profileEmailVerifiedIcon
                  : svg_profileEmailUnverifiedIcon
              }
               </div>

               <div class="verify-email__status-title ">

               ${
                 profileUser.isEmailVerified
                   ? "Verified"
                   : "Verification Pending"
               }
               </div>
          </div>
      </div>

      <div class="verify-email__desc ${
        profileUser.isEmailVerified
          ? "verify-email__desc--verified"
          : "verify-email__desc--unverified"
      }">
      ${
        profileUser.isEmailVerified
          ? "If you click on Remove Email button, we will remove this email from your account."
          : "Click on Send Verification Link button and we will send the verification link to your email address."
      }
     </div>

           ${
             profileUser.isEmailVerified
               ? '<div class="verify-email__btn-container"><div class="verify-email__btn verify-email__btn--remove" id="removeUserEmailBtn">Remove Email</div></div>'
               : '<div class="verify-email__btn-container"><div class="verify-email__btn verify-email__btn--verify" id="verifyUserEmailBtn">Send Verification Link</div></div>'
           }
   
  `
  modalContentBox.insertAdjacentElement("beforeend", verifyEmail)
  attachScript(modalBox, profileUser)
}
function attachScript(modalBox, profileUser) {
  const verifyEmailInput = document.getElementById("verifyEmailInput")
  const verifyUserEmailBtn = document.getElementById("verifyUserEmailBtn")
  if (verifyUserEmailBtn)
    verifyUserEmailBtn.addEventListener("click", () => {
      if (verifyEmailInput.value.trim() !== "") {
        let emailValue = verifyEmailInput.value.trim()
        if (emailValidator.validate(emailValue)) {
          fetch("/user-auth/send-email-verification", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ userId: loginUser._id, email: emailValue })
          })
            .then(res => {
              if (res.ok) return res.json()
              throw new Error("Server error in sending email verification.")
            })
            .then(data => {
              if (data.isSuccess) {
                createMainNotification(
                  "Verification email is sent to your Email Box,Please go and verify your email",
                  "success"
                )
                setTimeout(() => {
                  if (!modalBox.classList.contains("hide"))
                    modalBox.classList.add("hide")
                }, 2000)
              } else {
                createMainNotification(data.error, "error")
              }
            })
            .catch(err => {
              createMainNotification(
                "Server error in sending email verification,Please try again",
                "error"
              )
            })
        } else {
          createMainNotification(
            "This Email Address is not valid, Please check it and try again",
            "error"
          )
        }
      } else {
        createMainNotification("Email should not be empty", "error")
      }
    })

  const removeUserEmailBtn = document.getElementById("removeUserEmailBtn")
  if (removeUserEmailBtn)
    removeUserEmailBtn.addEventListener("click", () => {
      fetch("/user-auth/remove-user-email", {
        method: "PATCH",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ userId: loginUser._id })
      })
        .then(res => {
          if (res.ok) return res.json()
          throw new Error("Server error in removing your email.")
        })
        .then(data => {
          if (data.isSuccess) {
            profileUser.email = ""
            loginUser.email = ""
            loginUser.isEmailVerified = false
            profileUser.isEmailVerified = false
            createMainNotification(
              "This email is removed from your account successfully.",
              "success"
            )
            setTimeout(() => {
              if (!modalBox.classList.contains("hide"))
                modalBox.classList.add("hide")
            }, 1000)
          } else {
            createMainNotification(data.error, "error")
          }
        })
        .catch(err => {
          createMainNotification(
            "Server error in removing your email, Please try again",
            "error"
          )
        })
    })
}
